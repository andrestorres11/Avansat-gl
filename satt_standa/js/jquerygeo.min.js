document.createElement("canvas").getContext||function(){function f(){return this.context_||(this.context_=new r(this))}function q(p,g){var o=H.call(arguments,2);return function(){return p.apply(g,o.concat(H.call(arguments)))}}function t(p){p.namespaces.g_vml_||p.namespaces.add("g_vml_","urn:schemas-microsoft-com:vml","#default#VML");p.namespaces.g_o_||p.namespaces.add("g_o_","urn:schemas-microsoft-com:office:office","#default#VML");if(!p.styleSheets.ex_canvas_){p=p.createStyleSheet();p.owningElement.id=
"ex_canvas_";p.cssText="canvas{display:inline-block;overflow:hidden;text-align:left;width:300px;height:150px}"}}function h(p){var g=p.srcElement;switch(p.propertyName){case "width":g.getContext().clearRect();g.style.width=g.attributes.width.nodeValue+"px";g.firstChild.style.width=g.clientWidth+"px";break;case "height":g.getContext().clearRect();g.style.height=g.attributes.height.nodeValue+"px";g.firstChild.style.height=g.clientHeight+"px"}}function b(p){p=p.srcElement;if(p.firstChild){p.firstChild.style.width=
p.clientWidth+"px";p.firstChild.style.height=p.clientHeight+"px"}}function a(){return[[1,0,0],[0,1,0],[0,0,1]]}function c(p,g){for(var o=a(),s=0;s<3;s++)for(var x=0;x<3;x++){for(var v=0,B=0;B<3;B++)v+=p[s][B]*g[B][x];o[s][x]=v}return o}function e(p,g){g.fillStyle=p.fillStyle;g.lineCap=p.lineCap;g.lineJoin=p.lineJoin;g.lineWidth=p.lineWidth;g.miterLimit=p.miterLimit;g.shadowBlur=p.shadowBlur;g.shadowColor=p.shadowColor;g.shadowOffsetX=p.shadowOffsetX;g.shadowOffsetY=p.shadowOffsetY;g.strokeStyle=p.strokeStyle;
g.globalAlpha=p.globalAlpha;g.font=p.font;g.textAlign=p.textAlign;g.textBaseline=p.textBaseline;g.arcScaleX_=p.arcScaleX_;g.arcScaleY_=p.arcScaleY_;g.lineScale_=p.lineScale_}function d(p){var g=p.indexOf("(",3),o=p.indexOf(")",g+1);g=p.substring(g+1,o).split(",");if(g.length!=4||p.charAt(3)!="a")g[3]=1;return g}function l(p,g,o){return Math.min(o,Math.max(g,p))}function m(p,g,o){o<0&&o++;o>1&&o--;return 6*o<1?p+(g-p)*6*o:2*o<1?g:3*o<2?p+(g-p)*(2/3-o)*6:p}function n(p){if(p in R)return R[p];var g,
o=1;p=String(p);if(p.charAt(0)=="#")g=p;else if(/^rgb/.test(p)){o=d(p);g="#";for(var s,x=0;x<3;x++){s=o[x].indexOf("%")!=-1?Math.floor(parseFloat(o[x])/100*255):+o[x];g+=M[l(s,0,255)]}o=+o[3]}else if(/^hsl/.test(p)){x=o=d(p);g=parseFloat(x[0])/360%360;g<0&&g++;s=l(parseFloat(x[1])/100,0,1);x=l(parseFloat(x[2])/100,0,1);if(s==0)s=x=g=x;else{var v=x<0.5?x*(1+s):x+s-x*s,B=2*x-v;s=m(B,v,g+1/3);x=m(B,v,g);g=m(B,v,g-1/3)}g="#"+M[Math.floor(s*255)]+M[Math.floor(x*255)]+M[Math.floor(g*255)];o=o[3]}else g=
p;return R[p]={color:g,alpha:o}}function r(p){this.m_=a();this.mStack_=[];this.aStack_=[];this.currentPath_=[];this.fillStyle=this.strokeStyle="#000";this.lineWidth=1;this.lineJoin="miter";this.lineCap="butt";this.miterLimit=I*1;this.globalAlpha=1;this.canvas=p;var g="width:"+p.clientWidth+"px;height:"+p.clientHeight+"px;overflow:hidden;position:absolute",o=p.ownerDocument.createElement("div");o.style.cssText=g;p.appendChild(o);g=o.cloneNode(false);g.style.backgroundColor="red";g.style.filter="alpha(opacity=0)";
p.appendChild(g);this.element_=o;this.lineScale_=this.arcScaleY_=this.arcScaleX_=1}function u(p,g,o,s){p.currentPath_.push({type:"bezierCurveTo",cp1x:g.x,cp1y:g.y,cp2x:o.x,cp2y:o.y,x:s.x,y:s.y});p.currentX_=s.x;p.currentY_=s.y}function w(p,g,o){p=p.m_;return{x:I*(g*p[0][0]+o*p[1][0]+p[2][0])-D,y:I*(g*p[0][1]+o*p[1][1]+p[2][1])-D}}function A(p,g,o){if(isFinite(g[0][0])&&isFinite(g[0][1])&&isFinite(g[1][0])&&isFinite(g[1][1])&&isFinite(g[2][0])&&isFinite(g[2][1])){p.m_=g;if(o)p.lineScale_=P(J(g[0][0]*
g[1][1]-g[0][1]*g[1][0]))}}function C(p){this.code=this[p];this.message=p+": DOM Exception "+this.code}var F=Math,y=F.round,K=F.sin,E=F.cos,J=F.abs,P=F.sqrt,I=10,D=I/2;navigator.userAgent.match(/MSIE ([\d.]+)?/);var H=Array.prototype.slice;t(document);F={init:function(p){p=p||document;p.createElement("canvas");p.attachEvent("onreadystatechange",q(this.init_,this,p))},init_:function(p){p=p.getElementsByTagName("canvas");for(var g=0;g<p.length;g++)this.initElement(p[g])},initElement:function(p){if(!p.getContext){p.getContext=
f;t(p.ownerDocument);p.innerHTML="";p.attachEvent("onpropertychange",h);p.attachEvent("onresize",b);var g=p.attributes;if(g.width&&g.width.specified)p.style.width=g.width.nodeValue+"px";else p.width=p.clientWidth;if(g.height&&g.height.specified)p.style.height=g.height.nodeValue+"px";else p.height=p.clientHeight}return p}};F.init();for(var M=[],z=0;z<16;z++)for(var L=0;L<16;L++)M[z*16+L]=z.toString(16)+L.toString(16);var R={},U={butt:"flat",round:"round"};z=r.prototype;z.clearRect=function(){if(this.textMeasureEl_){this.textMeasureEl_.removeNode(true);
this.textMeasureEl_=null}this.element_.innerHTML=""};z.beginPath=function(){this.currentPath_=[]};z.moveTo=function(p,g){var o=w(this,p,g);this.currentPath_.push({type:"moveTo",x:o.x,y:o.y});this.currentX_=o.x;this.currentY_=o.y};z.lineTo=function(p,g){var o=w(this,p,g);this.currentPath_.push({type:"lineTo",x:o.x,y:o.y});this.currentX_=o.x;this.currentY_=o.y};z.bezierCurveTo=function(p,g,o,s,x,v){x=w(this,x,v);p=w(this,p,g);o=w(this,o,s);u(this,p,o,x)};z.quadraticCurveTo=function(p,g,o,s){p=w(this,
p,g);o=w(this,o,s);s={x:this.currentX_+2/3*(p.x-this.currentX_),y:this.currentY_+2/3*(p.y-this.currentY_)};u(this,s,{x:s.x+(o.x-this.currentX_)/3,y:s.y+(o.y-this.currentY_)/3},o)};z.arc=function(p,g,o,s,x,v){o*=I;var B=v?"at":"wa",G=p+E(s)*o-D,N=g+K(s)*o-D;s=p+E(x)*o-D;x=g+K(x)*o-D;if(G==s&&!v)G+=0.125;p=w(this,p,g);G=w(this,G,N);s=w(this,s,x);this.currentPath_.push({type:B,x:p.x,y:p.y,radius:o,xStart:G.x,yStart:G.y,xEnd:s.x,yEnd:s.y})};z.stroke=function(p){var g=[];g.push("<g_vml_:shape",' filled="',
!!p,'"',' style="position:absolute;width:',10,"px;height:",10,'px;"',' coordorigin="0,0"',' coordsize="',I*10,",",I*10,'"',' stroked="',!p,'"',' path="');for(var o={x:null,y:null},s={x:null,y:null},x=0;x<this.currentPath_.length;x++){var v=this.currentPath_[x];switch(v.type){case "moveTo":g.push(" m ",y(v.x),",",y(v.y));break;case "lineTo":g.push(" l ",y(v.x),",",y(v.y));break;case "close":g.push(" x ");v=null;break;case "bezierCurveTo":g.push(" c ",y(v.cp1x),",",y(v.cp1y),",",y(v.cp2x),",",y(v.cp2y),
",",y(v.x),",",y(v.y));break;case "at":case "wa":g.push(" ",v.type," ",y(v.x-this.arcScaleX_*v.radius),",",y(v.y-this.arcScaleY_*v.radius)," ",y(v.x+this.arcScaleX_*v.radius),",",y(v.y+this.arcScaleY_*v.radius)," ",y(v.xStart),",",y(v.yStart)," ",y(v.xEnd),",",y(v.yEnd))}if(v){if(o.x==null||v.x<o.x)o.x=v.x;if(s.x==null||v.x>s.x)s.x=v.x;if(o.y==null||v.y<o.y)o.y=v.y;if(s.y==null||v.y>s.y)s.y=v.y}}g.push(' ">');if(p){p=n(this.fillStyle);g.push('<g_vml_:fill color="',p.color,'" opacity="',p.alpha*this.globalAlpha,
'" />')}else{o=n(this.strokeStyle);p=o.color;o=o.alpha*this.globalAlpha;s=this.lineScale_*this.lineWidth;if(s<1)o*=s;g.push("<g_vml_:stroke",' opacity="',o,'"',' joinstyle="',this.lineJoin,'"',' miterlimit="',this.miterLimit,'"',' endcap="',U[this.lineCap]||"square",'"',' weight="',s,'px"',' color="',p,'" />')}g.push("</g_vml_:shape>");this.element_.insertAdjacentHTML("beforeEnd",g.join(""))};z.fill=function(){this.stroke(true)};z.closePath=function(){this.currentPath_.push({type:"close"})};z.save=
function(){var p={};e(this,p);this.aStack_.push(p);this.mStack_.push(this.m_);this.m_=c(a(),this.m_)};z.restore=function(){if(this.aStack_.length){e(this.aStack_.pop(),this);this.m_=this.mStack_.pop()}};z.translate=function(p,g){A(this,c([[1,0,0],[0,1,0],[p,g,1]],this.m_),false)};z.scale=function(p,g){this.arcScaleX_*=p;this.arcScaleY_*=g;A(this,c([[p,0,0],[0,g,0],[0,0,1]],this.m_),true)};z=C.prototype=Error();z.INDEX_SIZE_ERR=1;z.DOMSTRING_SIZE_ERR=2;z.HIERARCHY_REQUEST_ERR=3;z.WRONG_DOCUMENT_ERR=
4;z.INVALID_CHARACTER_ERR=5;z.NO_DATA_ALLOWED_ERR=6;z.NO_MODIFICATION_ALLOWED_ERR=7;z.NOT_FOUND_ERR=8;z.NOT_SUPPORTED_ERR=9;z.INUSE_ATTRIBUTE_ERR=10;z.INVALID_STATE_ERR=11;z.SYNTAX_ERR=12;z.INVALID_MODIFICATION_ERR=13;z.NAMESPACE_ERR=14;z.INVALID_ACCESS_ERR=15;z.VALIDATION_ERR=16;z.TYPE_MISMATCH_ERR=17;G_vmlCanvasManager=F;CanvasRenderingContext2D=r;DOMException=C}();
$.widget||function(f,q){if(f.cleanData){var t=f.cleanData;f.cleanData=function(b){for(var a=0,c;(c=b[a])!=null;a++)try{f(c).triggerHandler("remove")}catch(e){}t(b)}}else{var h=f.fn.remove;f.fn.remove=function(b,a){return this.each(function(){if(!a)if(!b||f.filter(b,[this]).length)f("*",this).add([this]).each(function(){try{f(this).triggerHandler("remove")}catch(c){}});return h.call(f(this),b,a)})}}f.widget=function(b,a,c){var e=b.split(".")[0],d;b=b.split(".")[1];d=e+"-"+b;if(!c){c=a;a=f.Widget}f.expr[":"][d]=
function(l){return!!f.data(l,b)};f[e]=f[e]||{};f[e][b]=function(l,m){arguments.length&&this._createWidget(l,m)};a=new a;a.options=f.extend(true,{},a.options);f[e][b].prototype=f.extend(true,a,{namespace:e,widgetName:b,widgetEventPrefix:f[e][b].prototype.widgetEventPrefix||b,widgetBaseClass:d},c);f.widget.bridge(b,f[e][b])};f.widget.bridge=function(b,a){f.fn[b]=function(c){var e=typeof c==="string",d=Array.prototype.slice.call(arguments,1),l=this;c=!e&&d.length?f.extend.apply(null,[true,c].concat(d)):
c;if(e&&c.charAt(0)==="_")return l;e?this.each(function(){var m=f.data(this,b),n=m&&f.isFunction(m[c])?m[c].apply(m,d):m;if(n!==m&&n!==q){l=n;return false}}):this.each(function(){var m=f.data(this,b);m?m.option(c||{})._init():f.data(this,b,new a(c,this))});return l}};f.Widget=function(b,a){arguments.length&&this._createWidget(b,a)};f.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:false},_createWidget:function(b,a){f.data(a,this.widgetName,this);this.element=f(a);this.options=
f.extend(true,{},this.options,this._getCreateOptions(),b);var c=this;this.element.bind("remove."+this.widgetName,function(){c.destroy()});this._create();this._trigger("create");this._init()},_getCreateOptions:function(){return f.metadata&&f.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName);this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+
"-disabled ui-state-disabled")},widget:function(){return this.element},option:function(b,a){var c=b;if(arguments.length===0)return f.extend({},this.options);if(typeof b==="string"){if(a===q)return this.options[b];c={};c[b]=a}this._setOptions(c);return this},_setOptions:function(b){var a=this;f.each(b,function(c,e){a._setOption(c,e)});return this},_setOption:function(b,a){this.options[b]=a;if(b==="disabled")this.widget()[a?"addClass":"removeClass"](this.widgetBaseClass+"-disabled ui-state-disabled").attr("aria-disabled",
a);return this},enable:function(){return this._setOption("disabled",false)},disable:function(){return this._setOption("disabled",true)},_trigger:function(b,a,c){var e,d=this.options[b];c=c||{};a=f.Event(a);a.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase();a.target=this.element[0];if(b=a.originalEvent)for(e in b)e in a||(a[e]=b[e]);this.element.trigger(a,c);return!(f.isFunction(d)&&d.call(this.element[0],a,c)===false||a.isDefaultPrevented())}}}(jQuery);
window.JsViews||window.jQuery&&jQuery.views||function(f,q){function t(g,o,s,x,v){var B=(s=s||{viewsCount:0,ctx:n.helpers})&&s.ctx;return{jsViews:"v1.0pre",path:o||"",itemNumber:++s.viewsCount||1,viewsCount:0,tmpl:v,data:x||s.data||{},ctx:g&&g===B?B:B?F(F({},B),g):g||{},parent:s}}function h(g,o,s,x,v,B,G){return s?(x?v?"$view."+v:s:"$data."+s)+(B||""):G||o||""}function b(g){function o(O){O-=x;O&&G.push(g.substr(x,O).replace(D,"\\n"))}var s,x=0,v=[],B=[],G=B,N=[,,B];g=g.replace(M,"\\$1");g.replace(w,
function(O,S,Q,ga,ha,T,ia,ja,ka,ca){function la(Z,V,ma,da,na,oa,ea,fa,pa,qa){return W?(W=!ea,W?Z:'"'):X?(X=!fa,X?Z:'"'):da?V.replace(P,h)+da:na?Y?"":(aa=K,"\u0008"+V+":"):ma?(Y++,V.replace(P,h)+"("):pa?(Y--,")"):V?V.replace(P,h):oa?",":qa?Y?"":aa?(aa=y,"\u0008"):",":(W=ea,X=fa,'"')}var aa,ba="",Y=0,X=y,W=y;Q=Q||ga;o(ca);if(ha)n.allowCode&&G.push(["*",T.replace(H,"$1")]);else if(Q){if(Q==="else"){N=v.pop();G=N[2];S=K}T=T?(T+" ").replace(I,la).replace(z,function(Z,V){ba+=V+",";return""}):"";T=T.slice(0,
-1);s=[Q,ia?ja||"none":"",S&&[],"{"+ba+"_hash:'"+ba+"',_path:'"+T+"'}",T];if(S){v.push(N);N=s}G.push(s)}else if(ka)N=v.pop();x=ca+O.length;if(!N)throw"Expected block tag";G=N[2]});o(g.length);return a(B)}function a(g){var o,s,x=[],v=g.length,B="try{var views="+(E?"jQuery":"JsViews")+'.views,tag=views.renderTag,enc=views.encode,html=views.encoders.html,$ctx=$view && $view.ctx,result=""+\n\n';for(s=0;s<v;s++){o=g[s];if(o[0]==="*")B=B.slice(0,s?-1:-3)+";"+o[1]+(s+1<v?"result+=":"");else if(""+o===o)B+=
'"'+o+'"+';else{var G=o[0],N=o[1],O=o[2],S=o[3];o=o[4];var Q=o+'||"")+';O&&x.push(a(O));B+=G==="="?!N||N==="html"?"html("+Q:N==="none"?"("+Q:'enc("'+N+'",'+Q:'tag("'+G+'",$view,"'+(N||"")+'",'+(O?x.length:'""')+","+S+(o?",":"")+o+")+"}}g=new Function("$data, $view",B.slice(0,-1)+";return result;\n\n}catch(e){return views.err(e);}");g.nested=x;return g}function c(g){return R[g]||(R[g]="&#"+g.charCodeAt(0)+";")}function e(g){try{return d(g)}catch(o){}return g}var d,l,m,n,r,u,w,A,C,F,y=false,K=true,
E=f.jQuery,J=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,P=/^(true|false|null|[\d\.]+)|(\w+|\$(view|data|ctx|(\w+)))([\w\.]*)|((['"])(?:\\\1|.)*\7)$/g,I=/(\$?[\w\.\[\]]+)(?:(\()|\s*(===|!==|==|!=|<|>|<=|>=)\s*|\s*(\=)\s*)?|(\,\s*)|\\?(\')|\\?(\")|(\))|(\s+)/g,D=/\r?\n/g,H=/\\(['"])/g,M=/\\?(['"])/g,z=/\x08([^\x08]+)\x08/g,L=0,R={"&":"&amp;","<":"&lt;",">":"&gt;"},U=/[\x00"&'<>]/g,p=Array.prototype.slice;if(E){d=E;d.fn.extend({render:function(g,o,s,x){return u(g,this[0],o,s,x)},template:function(g,o){return d.template(g,
this[0],o)}})}else{l=f.$;f.JsViews=m=f.$=d={extend:function(g,o){for(var s in o)g[s]=o[s];return g},isArray:Array.isArray||function(g){return Object.prototype.toString.call(g)==="[object Array]"},noConflict:function(){if(f.$===m)f.$=l;return m}}}F=d.extend;F(d,{views:n={templates:{},tags:{"if":function(){var g=this._view;g.onElse=function(o,s){for(var x=0,v=s.length;v&&!s[x++];)if(x===v)return"";g.onElse=q;return u(g.data,o.tmpl,g.ctx,g)};return g.onElse(this,arguments)},"else":function(){var g=this._view;
return g.onElse?g.onElse(this,arguments):""},each:function(){var g,o="",s=arguments,x=s.length,v=this.tmpl,B=this._view;for(g=0;g<x;g++)o+=s[g]?u(s[g],v,this.ctx||B.ctx,B,this._path,this._ctor):"";return x?o:o+u(B.data,v,B.ctx,B,this._path,this.tag)},"=":function(g){return g},"*":function(g){return g}},helpers:{not:function(g){return!g}},allowCode:y,debugMode:K,err:function(g){return n.debugMode?"<br/><b>Error:</b> <em> "+(g.message||g)+". </em>":'""'},setDelimiters:function(g,o){var s=o.charAt(0),
x=o.charAt(1);g="\\"+g.charAt(0)+"\\"+g.charAt(1);o="\\"+s+"\\"+x;w=g+"(?:(?:(\\#)?(\\w+(?=[!\\s\\"+s+"]))|(?:(\\=)|(\\*)))\\s*((?:[^\\"+s+"]|\\"+s+"(?!\\"+x+"))*?)(!(\\w*))?|(?:\\/([\\w\\$\\.\\[\\]]+)))"+o;w=RegExp(w,"g")},registerTags:A=function(g,o){var s;if(typeof g==="object")for(s in g)A(s,g[s]);else n.tags[g]=o;return this},registerHelpers:C=function(g,o){if(typeof g==="object")for(var s in g)C(s,g[s]);else n.helpers[g]=o;return this},encode:function(g,o){return o?(r[g||"html"]||r.html)(o):
""},encoders:r={none:function(g){return g},html:function(g){return String(g).replace(U,c)}},renderTag:function(g,o,s,x,v){var B,G;B=arguments;G=n.presenters;hash=v._hash;tagFn=n.tags[g];if(!tagFn)return"";x=x&&o.tmpl.nested[x-1];v.tmpl=v.tmpl||x||q;if(G&&G[g]){G=F(F({},v.ctx),v);delete G.ctx;delete G._path;delete G.tmpl;v.ctx=G;v._ctor=g+(hash?"="+hash.slice(0,-1):"");v=F(F({},tagFn),v);tagFn=n.tags.each}v._encode=s;v._view=o;return(B=tagFn.apply(v,B.length>5?p.call(B,5):[o.data]))||(B===q?"":B.toString())}},
render:u=function(g,o,s,x,v,B){var G,N,O,S,Q="";if(arguments.length===2&&g.jsViews){x=g;s=x.ctx;g=x.data}o=d.template(o);if(!o)return"";if(d.isArray(g)){S=new t(s,v,x,g);G=0;for(N=g.length;G<N;G++){O=(O=g[G])?o(O,new t(s,v,S,O,o,this)):"";Q+=n.activeViews?"<!--item--\>"+O+"<!--/item--\>":O}}else Q+=o(g,new t(s,v,x,g,o));return n.activeViews?"<!--tmpl("+(v||"")+") "+(B?"tag="+B:o._name)+"--\>"+Q+"<!--/tmpl--\>":Q},template:function(g,o){if(o){if(""+o===o)o=b(o);else if(E&&o instanceof d)o=o[0];if(o){if(E&&
o.nodeType)o=d.data(o,"tmpl")||d.data(o,"tmpl",b(o.innerHTML));n.templates[o._name=o._name||g||"_"+L++]=o}return o}return g?""+g!==g?g._name?g:d.template(null,g):n.templates[g]||d.template(null,J.test(g)?g:e(g)):null}});n.setDelimiters("{{","}}")}(window);
(function(f,q,t){var h=Number.POSITIVE_INFINITY,b=Number.NEGATIVE_INFINITY;f.geo={_allCoordinates:function(a){a=this._flatten(a);for(var c=0,e=[];c<a.length;c++){var d=a[c].coordinates,l=d&&f.isArray(d[0]),m=l&&f.isArray(d[0][0]),n;if(!(m&&f.isArray(d[0][0][0]))){if(!m){l||(d=[d]);d=[d]}d=[d]}for(l=0;l<d.length;l++)for(m=0;m<d[l].length;m++)for(n=0;n<d[l][m].length;n++)e.push(d[l][m][n])}return e},_isGeodetic:function(a){for(;f.isArray(a);)if(a.length>1&&!f.isArray(a[0]))return a[0]>=-180&&a[0]<=
180&&a[1]>=-85&&a[1]<=85;else a=a[0];return false},center:function(a,c){var e=false;if(!c&&f.geo.proj&&this._isGeodetic(a)){e=true;a=f.geo.proj.fromGeodetic(a)}var d=[(a[0]+a[2])/2,(a[1]+a[3])/2];return e?f.geo.proj.toGeodetic(d):d},expandBy:function(a,c,e,d){var l=false;if(!d&&f.geo.proj&&this._isGeodetic(a)){l=true;a=f.geo.proj.fromGeodetic(a)}a=[a[0]-c,a[1]-e,a[2]+c,a[3]+e];return l?f.geo.proj.toGeodetic(a):a},height:function(a,c){if(!c&&f.geo.proj&&this._isGeodetic(a))a=f.geo.proj.fromGeodetic(a);
return a[3]-a[1]},_in:function(a,c){return a[0]<=c[0]&&a[1]<=c[1]&&a[2]>=c[2]&&a[3]>=c[3]},_bboxDisjoint:function(a,c){return c[0]>a[2]||c[2]<a[0]||c[1]>a[3]||c[3]<a[1]},reaspect:function(a,c,e){var d=false;if(!e&&f.geo.proj&&this._isGeodetic(a)){d=true;a=f.geo.proj.fromGeodetic(a)}var l=this.width(a,true),m=this.height(a,true);e=this.center(a,true);if(l!=0&&m!=0&&c>0){if(l/m>c){a=l/2;l=a/c}else{l=m/2;a=l*c}a=[e[0]-a,e[1]-l,e[0]+a,e[1]+l]}return d?f.geo.proj.toGeodetic(a):a},recenter:function(a,c,
e){var d=false;if(!e&&f.geo.proj){if(this._isGeodetic(a)){d=true;a=f.geo.proj.fromGeodetic(a)}if(this._isGeodetic(c))c=f.geo.proj.fromGeodetic(c)}e=(a[2]-a[0])/2;a=(a[3]-a[1])/2;a=[c[0]-e,c[1]-a,c[0]+e,c[1]+a];return d?f.geo.proj.toGeodetic(a):a},scaleBy:function(a,c,e){var d=false;if(!e&&f.geo.proj&&this._isGeodetic(a)){d=true;a=f.geo.proj.fromGeodetic(a)}e=this.center(a,true);var l=(a[2]-a[0])*c/2;a=(a[3]-a[1])*c/2;a=[e[0]-l,e[1]-a,e[0]+l,e[1]+a];return d?f.geo.proj.toGeodetic(a):a},width:function(a,
c){if(!c&&f.geo.proj&&this._isGeodetic(a))a=f.geo.proj.fromGeodetic(a);return a[2]-a[0]},bbox:function(a,c){if(a)if(a.bbox)result=!c&&f.geo.proj&&this._isGeodetic(a.bbox)?f.geo.proj.fromGeodetic(a.bbox):a.bbox;else{result=[h,h,b,b];var e=this._allCoordinates(a),d=0;if(e.length==0)return t;var l=false;if(!c&&f.geo.proj&&this._isGeodetic(e)){l=true;e=f.geo.proj.fromGeodetic(e)}for(;d<e.length;d++){result[0]=Math.min(e[d][0],result[0]);result[1]=Math.min(e[d][1],result[1]);result[2]=Math.max(e[d][0],
result[2]);result[3]=Math.max(e[d][1],result[3])}}else return t;return l?f.geo.proj.toGeodetic(result):result},centroid:function(a,c){switch(a.type){case "Point":return f.extend({},a);case "LineString":case "Polygon":var e=0,d=[0,0],l=f.merge([],a.type=="Polygon"?a.coordinates[0]:a.coordinates),m=1,n,r,u=false;if(!c&&f.geo.proj&&this._isGeodetic(l)){u=true;l=f.geo.proj.fromGeodetic(l)}for(;m<=l.length;m++){n=m%l.length;r=l[m-1][0]*l[n][1]-l[n][0]*l[m-1][1];e+=r;d[0]+=(l[m-1][0]+l[n][0])*r;d[1]+=(l[m-
1][1]+l[n][1])*r}if(e==0)if(l.length>0){d[0]=l[0][0];d[1]=l[0][1];return{type:"Point",coordinates:u?f.geo.proj.toGeodetic(d):d}}else break;e*=3;d[0]/=e;d[1]/=e;return{type:"Point",coordinates:u?f.geo.proj.toGeodetic(d):d}}return t},contains:function(a,c){if(a.type!="Polygon")return false;switch(c.type){case "Point":return this._containsPolygonPoint(a.coordinates,c.coordinates);case "LineString":return this._containsPolygonLineString(a.coordinates,c.coordinates);case "Polygon":return this._containsPolygonLineString(a.coordinates,
c.coordinates[0]);default:return false}},_containsPolygonPoint:function(a,c){if(a.length==0||a[0].length<4)return false;for(var e=0,d=a[0][0],l=1,m;l<a[0].length;l++){m=a[0][l];if(d[1]<=c[1]&&c[1]<m[1]||m[1]<=c[1]&&c[1]<d[1]&&(c[0]<d[0]||c[0]<m[0])){d=d[0]+(m[0]-d[0])*(c[1]-d[1])/(m[1]-d[1]);d>c[0]&&e++}d=m}return e%2==1},_containsPolygonLineString:function(a,c){for(var e=0;e<c.length;e++)if(!this._containsPolygonPoint(a,c[e]))return false;return true},distance:function(a,c,e){var d=!e&&f.geo.proj&&
this._isGeodetic(a.coordinates)?f.geo.proj.fromGeodetic(a.coordinates):a.coordinates;e=!e&&f.geo.proj&&this._isGeodetic(c.coordinates)?f.geo.proj.fromGeodetic(c.coordinates):c.coordinates;switch(a.type){case "Point":switch(c.type){case "Point":return this._distancePointPoint(e,d);case "LineString":return this._distanceLineStringPoint(e,d);case "Polygon":return this._containsPolygonPoint(e,d)?0:this._distanceLineStringPoint(e[0],d);default:return t}case "LineString":switch(c.type){case "Point":return this._distanceLineStringPoint(d,
e);case "LineString":return this._distanceLineStringLineString(d,e);case "Polygon":return this._containsPolygonLineString(e,d)?0:this._distanceLineStringLineString(e[0],d);default:return t}case "Polygon":switch(c.type){case "Point":return this._containsPolygonPoint(d,e)?0:this._distanceLineStringPoint(d[0],e);case "LineString":return this._containsPolygonLineString(d,e)?0:this._distanceLineStringLineString(d[0],e);case "Polygon":return this._containsPolygonLineString(d,e[0])?0:this._distanceLineStringLineString(d[0],
e[0]);default:return t}}},_distancePointPoint:function(a,c){var e=c[0]-a[0],d=c[1]-a[1];return Math.sqrt(e*e+d*d)},_distanceLineStringPoint:function(a,c){var e=h;if(a.length>0){var d=a[0],l=c[0]-d[0],m=c[1]-d[1];if(a.length==1)return Math.sqrt(l*l+m*m);else for(var n=1;n<a.length;n++){var r=a[n],u=c[0]-r[0],w=c[1]-r[1];d=this._distanceSegmentPoint(r[0]-d[0],r[1]-d[1],l,m,u,w);if(d==0)return 0;if(d<e)e=d;d=r;l=u;m=w}}return Math.sqrt(e)},_distanceSegmentPoint:function(a,c,e,d,l,m){var n=a*e+c*d;if(n<=
0)return e*e+d*d;a=a*a+c*c;if(n>=a)return l*l+m*m;return e*e+d*d-n*n/a},_distanceLineStringLineString:function(a,c){for(var e=h,d=0;d<c.length;d++)e=Math.min(e,this._distanceLineStringPoint(a,c[d]));return e},_buffer:function(a,c,e){var d=false,l=a.coordinates;if(!e&&f.geo.proj&&this._isGeodetic(a.coordinates)){d=true;l=f.geo.proj.fromGeodetic(a.coordinates)}switch(a.type){case "Point":a=[];e=0;for(var m;e<=180;e++){m=e*360/180*(Math.PI/180);a.push([l[0]+Math.cos(m)*c,l[1]+Math.sin(m)*c])}return{type:"Polygon",
coordinates:[d?f.geo.proj.toGeodetic(a):a]};default:return t}},_flatten:function(a){var c=[],e=0;switch(a.type){case "Feature":f.merge(c,this._flatten(a.geometry));break;case "FeatureCollection":for(;e<a.features.length;e++)f.merge(c,this._flatten(a.features[e].geometry));break;case "GeometryCollection":for(;e<a.geometries.length;e++)f.merge(c,this._flatten(a.geometries[e]));break;default:c[0]=a}return c},length:function(a,c){var e=0,d,l=1,m,n;switch(a.type){case "Point":return 0;case "LineString":d=
a.coordinates;break;case "Polygon":d=a.coordinates[0]}if(d){if(!c&&f.geo.proj&&this._isGeodetic(d))d=f.geo.proj.fromGeodetic(d);for(;l<d.length;l++){m=d[l][0]-d[l-1][0];n=d[l][1]-d[l-1][1];e+=Math.sqrt(m*m+n*n)}return e}},area:function(a,c){var e=0,d,l=1,m;switch(a.type){case "Point":case "LineString":return 0;case "Polygon":d=a.coordinates[0]}if(d){if(!c&&f.geo.proj&&this._isGeodetic(d))d=f.geo.proj.fromGeodetic(d);for(;l<=d.length;l++){m=l%d.length;e+=(d[l-1][0]-d[m][0])*(d[l-1][1]+d[m][1])/2}return Math.abs(e)}},
pointAlong:function(a,c,e){var d=0,l=0,m=0,n,r=[],u=1,w=false;switch(a.type){case "Point":return f.extend({},a);case "LineString":n=a.coordinates;break;case "Polygon":n=a.coordinates[0]}if(n)if(c===0)return{type:"Point",coordinates:[n[0][0],n[0][1]]};else if(c===1){u=n.length-1;return{type:"Point",coordinates:[n[u][0],n[u][1]]}}else{if(!e&&f.geo.proj&&this._isGeodetic(n)){w=true;n=f.geo.proj.fromGeodetic(n)}for(;u<n.length;u++){a=n[u][0]-n[u-1][0];e=n[u][1]-n[u-1][1];a=Math.sqrt(a*a+e*e);r.push(a);
d+=a}for(u=0;u<r.length&&m<c;u++){l=m;m+=r[u]/d}c=c-l;d=n[u-1];n=n[u];n=[d[0]+c*(n[0]-d[0]),d[1]+c*(n[1]-d[1])];return{type:"Point",coordinates:w?f.geo.proj.toGeodetic(n):n}}},_WKT:function(){function a(d){if(d&&d.length){for(var l=[],m=0;m<d.length;m++)l.push(d[m].join(" "));return"("+l+")"}else return"EMPTY"}function c(d){if(d&&d.length){for(var l=[],m=0;m<d.length;m++)l.push(a(d[m]));return"("+l+")"}else return"EMTPY"}function e(d){if(d&&d.type)switch(d.type){case "Point":return"POINT "+(d.coordinates&&
d.coordinates.length?"("+d.coordinates.join(" ")+")":"EMPTY");case "LineString":return"LINESTRING "+a(d.coordinates);case "Polygon":return"POLYGON "+c(d.coordinates);case "MultiPoint":return"MULTIPOINT "+a(d.coordinates);case "MultiLineString":return"MULTILINSTRING "+c(d.coordinates);case "MultiPolygon":if((d=d.coordinates)&&d.length){for(var l=[],m=0;m<d.length;m++)l.push(c(d[m]));d="("+l+")"}else d="EMPTY";return"MULTIPOLYGON "+d;case "GeometryCollection":if((d=d.geometries)&&d.length){l=[];for(m=
0;m<d.length;m++)l.push(e(d[m]));d="("+d+")"}else d="EMPTY";return"GEOMETRYCOLLECTION "+d;default:return""}else return""}return{stringify:e,parse:function(d){d=f.trim(d);var l=d.indexOf(" "),m=d.substr(l+1);switch(d.substr(0,l).toUpperCase()){case "POINT":return(d=m.match(/\(\s*([\d\.-]+)\s+([\d\.-]+)\s*\)/))&&d.length>2?{type:"Point",coordinates:[parseFloat(d[1]),parseFloat(d[2])]}:null;case "LINESTRING":m=m.match(/\s*\((.*)\)/);d=[];var n;l=0;if(m.length>1){for(m=m[1].match(/[\d\.-]+\s+[\d\.-]+/g);l<
m.length;l++){n=m[l].match(/\s*([\d\.-]+)\s+([\d\.-]+)\s*/);d[l]=[parseFloat(n[1]),parseFloat(n[2])]}d={type:"LineString",coordinates:d}}else d=null;return d;case "POLYGON":m=m.match(/\s*\(\s*\((.*)\)\s*\)/);d=[];l=0;if(m.length>1){for(m=m[1].match(/[\d\.-]+\s+[\d\.-]+/g);l<m.length;l++){n=m[l].match(/\s*([\d\.-]+)\s+([\d\.-]+)\s*/);d[l]=[parseFloat(n[1]),parseFloat(n[2])]}d={type:"Polygon",coordinates:[d]}}else d=null;return d;default:return null}}}}(),proj:function(){return{fromGeodeticPos:function(a){if(!a)debugger;
return[6378137*a[0]*0.017453292519943295,6378137*Math.log(Math.tan(0.7853981633974483+a[1]*0.017453292519943295/2))]},fromGeodetic:function(a){if(!f.geo._isGeodetic(a))return a;var c=f.isArray(a[0]),e=this.fromGeodeticPos;if(!c&&a.length==4){c=e([a[0],a[1]]);a=e([a[2],a[3]]);return[c[0],c[1],a[0],a[1]]}else{var d=c&&f.isArray(a[0][0]),l=d&&f.isArray(a[0][0][0]),m=[],n,r,u;if(!l){if(!d){c||(a=[a]);a=[a]}a=[a]}for(n=0;n<a.length;n++){m[n]=[];for(r=0;r<a[n].length;r++){m[n][r]=[];for(u=0;u<a[n][r].length;u++)m[n][r][u]=
e(a[n][r][u])}}return l?m:d?m[0]:c?m[0][0]:m[0][0][0]}},toGeodeticPos:function(a){return[a[0]/6378137*57.29577951308232,(1.5707963267948966-2*Math.atan(1/Math.exp(a[1]/6378137)))*57.29577951308232]},toGeodetic:function(a){if(f.geo._isGeodetic(a))return a;var c=f.isArray(a[0]),e=this.toGeodeticPos;if(!c&&a.length==4){c=e([a[0],a[1]]);a=e([a[2],a[3]]);return[c[0],c[1],a[0],a[1]]}else{var d=c&&f.isArray(a[0][0]),l=d&&f.isArray(a[0][0][0]),m=[];if(!l){if(!d){c||(a=[a]);a=[a]}a=[a]}for(i=0;i<a.length;i++){m[i]=
[];for(j=0;j<a[i].length;j++){m[i][j]=[];for(k=0;k<a[i][j].length;k++)m[i][j][k]=e(a[i][j][k])}}return l?m:d?m[0]:c?m[0][0]:m[0][0][0]}}}}(),_serviceTypes:{}}})(jQuery,this);
(function(f,q){var t=function(){for(var h=5,b=document.createElement("div"),a=b.all||[];b.innerHTML="<!--[if gt IE "+ ++h+"]><br><![endif]--\>",a[0];);return h>6?h:!h}();f.widget("geo.geographics",{_$elem:q,_options:{},_trueCanvas:true,_width:0,_height:0,_$canvas:q,_context:q,_$blitcanvas:q,_blitcontext:q,_$labelsContainer:q,options:{style:{borderRadius:"8px",color:"#7f0000",fillOpacity:0.2,height:"8px",opacity:1,strokeOpacity:1,strokeWidth:"2px",visibility:"visible",width:"8px"}},_create:function(){this._$elem=
this.element;this._options=this.options;this._$elem.css({display:"inline-block",overflow:"hidden",textAlign:"left"});this._$elem.css("position")=="static"&&this._$elem.css("position","relative");this._$elem.addClass("geo-graphics");this._width=this._$elem.width();this._height=this._$elem.height();if(!(this._width&&this._height)){this._width=parseInt(this._$elem.css("width"));this._height=parseInt(this._$elem.css("height"))}var h="width:"+this._width+"px;height:"+this._height+"px;",b='width="'+this._width+
'" height="'+this._height+'"';if(document.createElement("canvas").getContext){this._$elem.append("<canvas "+b+' style="position:absolute;left:0;top:0;margin:0;padding:0;"></canvas>');this._$canvas=this._$elem.children(":last");this._context=this._$canvas[0].getContext("2d");this._$elem.append("<canvas "+b+' style="position:absolute;left:0;top:0;margin:0;padding:0; visibility: hidden;"></canvas>');this._$blitcanvas=this._$elem.children(":last");this._blitcontext=this._$blitcanvas[0].getContext("2d")}else if(t<=
8){this._trueCanvas=false;this._$elem.append("<div "+b+' style="position:absolute;left:0;top:0;margin:0;padding:0;'+h+'"></div>');this._$canvas=this._$elem.children(":last");G_vmlCanvasManager.initElement(this._$canvas[0]);this._context=this._$canvas[0].getContext("2d");this._$canvas.children().css({backgroundColor:"transparent",width:this._width,height:this._height})}this._$elem.append('<div class="geo-labels-container" style="position:absolute;left:0;top:0;margin:0;padding:0;'+h+'"></div>');this._$labelsContainer=
this._$elem.children(":last")},_setOption:function(h,b){if(h=="style")b=f.extend({},this._options.style,b);f.Widget.prototype._setOption.apply(this,arguments)},destroy:function(){f.Widget.prototype.destroy.apply(this,arguments);this._$elem.html("");this._$elem.removeClass("geo-graphics")},clear:function(){this._context.clearRect(0,0,this._width,this._height);this._$labelsContainer.html("")},drawArc:function(h,b,a,c){c=this._getGraphicStyle(c);if(c.visibility!="hidden"&&c.opacity>0&&c.widthValue>0&&
c.heightValue>0){var e=Math.min(c.widthValue,c.heightValue)/2;b=b*Math.PI/180;a=a*Math.PI/180;this._context.save();this._context.translate(h[0],h[1]);c.widthValue>c.heightValue?this._context.scale(c.widthValue/c.heightValue,1):this._context.scale(1,c.heightValue/c.widthValue);this._context.beginPath();this._context.arc(0,0,e,b,a,false);this._trueCanvas&&this._context.restore();if(c.doFill){this._context.fillStyle=c.fill;this._context.globalAlpha=c.opacity*c.fillOpacity;this._context.fill()}if(c.doStroke){this._context.lineJoin=
"round";this._context.lineWidth=c.strokeWidthValue;this._context.strokeStyle=c.stroke;this._context.globalAlpha=c.opacity*c.strokeOpacity;this._context.stroke()}this._trueCanvas||this._context.restore()}},drawPoint:function(h,b){b=this._getGraphicStyle(b);if(b.widthValue==b.heightValue&&b.heightValue==b.borderRadiusValue)this.drawArc(h,0,360,b);else if(b.visibility!="hidden"&&b.opacity>0){b.borderRadiusValue=Math.min(Math.min(b.widthValue,b.heightValue)/2,b.borderRadiusValue);h[0]-=b.widthValue/2;
h[1]-=b.heightValue/2;this._context.beginPath();this._context.moveTo(h[0]+b.borderRadiusValue,h[1]);this._context.lineTo(h[0]+b.widthValue-b.borderRadiusValue,h[1]);this._context.quadraticCurveTo(h[0]+b.widthValue,h[1],h[0]+b.widthValue,h[1]+b.borderRadiusValue);this._context.lineTo(h[0]+b.widthValue,h[1]+b.heightValue-b.borderRadiusValue);this._context.quadraticCurveTo(h[0]+b.widthValue,h[1]+b.heightValue,h[0]+b.widthValue-b.borderRadiusValue,h[1]+b.heightValue);this._context.lineTo(h[0]+b.borderRadiusValue,
h[1]+b.heightValue);this._context.quadraticCurveTo(h[0],h[1]+b.heightValue,h[0],h[1]+b.heightValue-b.borderRadiusValue);this._context.lineTo(h[0],h[1]+b.borderRadiusValue);this._context.quadraticCurveTo(h[0],h[1],h[0]+b.borderRadiusValue,h[1]);this._context.closePath();if(b.doFill){this._context.fillStyle=b.fill;this._context.globalAlpha=b.opacity*b.fillOpacity;this._context.fill()}if(b.doStroke){this._context.lineJoin="round";this._context.lineWidth=b.strokeWidthValue;this._context.strokeStyle=b.stroke;
this._context.globalAlpha=b.opacity*b.strokeOpacity;this._context.stroke()}}},drawLineString:function(h,b){this._drawLines([h],false,b)},drawPolygon:function(h,b){if(!this._trueCanvas||h.length==1)this._drawLines(h,true,b);else if(!(!h||!h.length||h[0].length<3)){b=this._getGraphicStyle(b);var a,c,e;if(b.visibility!="hidden"&&b.opacity>0){this._blitcontext.clearRect(0,0,this._width,this._height);if(b.doFill)if(h.length>1){this._blitcontext.globalCompositeOperation="source-out";for(c=this._blitcontext.globalAlpha=
1;c<h.length;c++){this._blitcontext.beginPath();this._blitcontext.moveTo(h[c][0][0],h[c][0][1]);for(e=1;e<h[c].length;e++)this._blitcontext.lineTo(h[c][e][0],h[c][e][1]);this._blitcontext.closePath();this._blitcontext.fill()}}this._blitcontext.beginPath();this._blitcontext.moveTo(h[0][0][0],h[0][0][1]);a=[h[0][0][0]-b.strokeWidthValue,h[0][0][1]-b.strokeWidthValue,h[0][0][0]+b.strokeWidthValue,h[0][0][1]+b.strokeWidthValue];for(c=1;c<h[0].length-1;c++){this._blitcontext.lineTo(h[0][c][0],h[0][c][1]);
a[0]=Math.min(h[0][c][0]-b.strokeWidthValue,a[0]);a[1]=Math.min(h[0][c][1]-b.strokeWidthValue,a[1]);a[2]=Math.max(h[0][c][0]+b.strokeWidthValue,a[2]);a[3]=Math.max(h[0][c][1]+b.strokeWidthValue,a[3])}this._blitcontext.closePath();this._blitcontext.globalCompositeOperation="source-out";if(b.doFill){this._blitcontext.fillStyle=b.fill;this._blitcontext.globalAlpha=b.opacity*b.fillOpacity;this._blitcontext.fill()}this._blitcontext.globalCompositeOperation="source-over";if(b.doStroke){this._blitcontext.lineCap=
this._blitcontext.lineJoin="round";this._blitcontext.lineWidth=b.strokeWidthValue;this._blitcontext.strokeStyle=b.stroke;this._blitcontext.globalAlpha=b.opacity*b.strokeOpacity;this._blitcontext.stroke();if(h.length>1)for(c=1;c<h.length;c++){this._blitcontext.beginPath();this._blitcontext.moveTo(h[c][0][0],h[c][0][1]);for(e=1;e<h[c].length;e++)this._blitcontext.lineTo(h[c][e][0],h[c][e][1]);this._blitcontext.closePath();this._blitcontext.stroke()}}a[0]=Math.max(a[0],0);a[1]=Math.max(a[1],0);a[2]=
Math.min(a[2],this._width);a[3]=Math.min(a[3],this._height);this._context.drawImage(this._$blitcanvas[0],a[0],a[1],a[2]-a[0],a[3]-a[1],a[0],a[1],a[2]-a[0],a[3]-a[1])}}},drawBbox:function(h,b){this._drawLines([[[h[0],h[1]],[h[0],h[3]],[h[2],h[3]],[h[2],h[1]],[h[0],h[1]]]],true,b)},drawLabel:function(h,b){this._$labelsContainer.append('<div class="geo-label" style="position:absolute; left:'+h[0]+"px; top:"+h[1]+'px;">'+b+"</div>")},resize:function(){this._width=this._$elem.width();this._height=this._$elem.height();
if(!(this._width&&this._height)){this._width=parseInt(this._$elem.css("width"));this._height=parseInt(this._$elem.css("height"))}if(this._trueCanvas){this._$canvas[0].width=this._width;this._$canvas[0].height=this._height}this._$labelsContainer.css({width:this._width,height:this._height})},_getGraphicStyle:function(h){function b(a){a=parseInt(a);return+a+""===a?+a:a}h=f.extend({},this._options.style,h);h.borderRadiusValue=b(h.borderRadius);h.fill=h.fill||h.color;h.doFill=h.fill&&h.fillOpacity>0;h.stroke=
h.stroke||h.color;h.strokeWidthValue=b(h.strokeWidth);h.doStroke=h.stroke&&h.strokeOpacity>0&&h.strokeWidthValue>0;h.widthValue=b(h.width);h.heightValue=b(h.height);return h},_drawLines:function(h,b,a){if(!(!h||!h.length||h[0].length<2)){a=this._getGraphicStyle(a);var c,e;if(a.visibility!="hidden"&&a.opacity>0){this._context.beginPath();for(c=0;c<h.length;c++){this._context.moveTo(h[c][0][0],h[c][0][1]);for(e=1;e<h[c].length;e++)this._context.lineTo(h[c][e][0],h[c][e][1])}b&&this._context.closePath();
if(b&&a.doFill){this._context.fillStyle=a.fill;this._context.globalAlpha=a.opacity*a.fillOpacity;this._context.fill()}if(a.doStroke){this._context.lineCap=this._context.lineJoin="round";this._context.lineWidth=a.strokeWidthValue;this._context.strokeStyle=a.stroke;this._context.globalAlpha=a.opacity*a.strokeOpacity;this._context.stroke()}}}}})})(jQuery);
(function(f,q){var t=0,h=function(){for(var b=5,a=document.createElement("div"),c=a.all||[];a.innerHTML="<!--[if gt IE "+ ++b+"]><br><![endif]--\>",c[0];);return b>6?b:!b}();f.widget("geo.geomap",{_$elem:q,_map:q,_created:false,_widgetId:0,_contentBounds:{},_$resizeContainer:q,_$eventTarget:q,_$contentFrame:q,_$existingChildren:q,_$attrList:q,_$servicesContainer:q,_$panContainer:q,_$shapesContainer:q,_$drawContainer:q,_$measureContainer:q,_$measureLabel:q,_dpi:96,_currentServices:[],_center:q,_pixelSize:q,
_centerMax:q,_pixelSizeMax:q,_userGeodetic:true,_wheelTimeout:null,_wheelLevel:0,_zoomFactor:2,_fullZoomFactor:2,_partialZoomFactor:1.18920711500273,_mouseDown:q,_inOp:q,_toolPan:q,_shiftZoom:q,_anchor:q,_current:q,_downDate:q,_moveDate:q,_clickDate:q,_lastMove:q,_lastDrag:q,_windowHandler:null,_resizeTimeout:null,_panning:q,_velocity:q,_friction:q,_supportTouch:q,_softDblClick:q,_isTap:q,_isDbltap:q,_isMultiTouch:q,_multiTouchAnchor:q,_multiTouchAnchorBbox:q,_multiTouchCurrentBbox:q,_drawTimeout:null,
_drawPixels:[],_drawCoords:[],_graphicShapes:[],_initOptions:{},_options:{},options:f.extend({},{bbox:[-180,-85,180,85],bboxMax:[-180,-85,180,85],center:[0,0],cursors:{"static":"default",pan:"url(data:image/vnd.microsoft.icon;base64,AAACAAEAICACAAgACAAwAQAAFgAAACgAAAAgAAAAQAAAAAEAAQAAAAAAAAEAAAAAAAAAAAAAAgAAAAAAAAAAAAAA////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD8AAAA/AAAAfwAAAP+AAAH/gAAB/8AAA//AAAd/wAAGf+AAAH9gAADbYAAA2yAAAZsAAAGbAAAAGAAAAAAAAA//////////////////////////////////////////////////////////////////////////////////////gH///4B///8Af//+AD///AA///wAH//4AB//8AAf//AAD//5AA///gAP//4AD//8AF///AB///5A////5///8=), move",
zoom:"crosshair",drawPoint:"crosshair",drawLineString:"crosshair",drawPolygon:"crosshair",measureLength:"crosshair",measureArea:"crosshair"},measureLabels:{length:"{{=length.toFixed( 2 )}} m",area:"{{=area.toFixed( 2 )}} sq m"},drawStyle:{},shapeStyle:{},mode:"pan",pannable:true,scroll:"default",services:[{"class":"osm",type:"tiled",src:function(b){return"http://tile.openstreetmap.org/"+b.zoom+"/"+b.tile.column+"/"+b.tile.row+".png"},attr:"&copy; OpenStreetMap &amp; contributors, CC-BY-SA"}],tilingScheme:{tileWidth:256,
tileHeight:256,levels:18,basePixelSize:156543.03392799935,origin:[-2.0037508342787E7,2.0037508342787E7]},axisLayout:"map",zoom:0,pixelSize:0}),_createWidget:function(b,a){this._$elem=f(a);if(this._$elem.is(".geo-service")){var c=this._$elem.closest(".geo-content-frame");this._$elem.append('<div class="geo-shapes-container" style="position:absolute; left:0; top:0; width:'+c.css("width")+"; height:"+c.css("height")+'; margin:0; padding:0;"></div>');this._$shapesContainer=this._$elem.children(":last")}else{this._widgetId=
t++;this._$elem.addClass("geo-map");this._initOptions=b||{};this._forcePosition(this._$elem);this._$elem.css("text-align","left");c=this._findMapSize();this._contentBounds={x:parseInt(this._$elem.css("padding-left")),y:parseInt(this._$elem.css("padding-top")),width:c.width,height:c.height};this._createChildren();this._center=this._centerMax=[0,0];this.options.pixelSize=this._pixelSize=this._pixelSizeMax=156543.03392799935;this._mouseDown=this._inOp=this._toolPan=this._shiftZoom=this._panning=this._isTap=
this._isDbltap=false;this._anchor=[0,0];this._current=[0,0];this._lastMove=[0,0];this._lastDrag=[0,0];this._velocity=[0,0];this._friction=[0.8,0.8];this._downDate=this._moveDate=this._clickDate=0;this._drawPixels=[];this._drawCoords=[]}this._graphicShapes=[];f.Widget.prototype._createWidget.apply(this,arguments)},_create:function(){this._options=this.options;if(this._$elem.is(".geo-service")){this._map=this._$elem.data("geoMap");this._$shapesContainer.geographics();this._options.shapeStyle=this._$shapesContainer.geographics("option",
"style")}else{this._map=this;this._softDblClick=(this._supportTouch="ontouchend"in document)||h==7;var b=this,a=this._supportTouch?"touchstart":"mousedown",c=this._supportTouch?"touchend touchcancel":"mouseup",e=this._supportTouch?"touchmove":"mousemove";f(document).keydown(f.proxy(this._document_keydown,this));this._$eventTarget.dblclick(f.proxy(this._eventTarget_dblclick,this));this._$eventTarget.bind(a,f.proxy(this._eventTarget_touchstart,this));a=this._$eventTarget[0].setCapture?this._$eventTarget:
f(document);a.bind(e,f.proxy(this._dragTarget_touchmove,this));a.bind(c,f.proxy(this._dragTarget_touchstop,this));this._$eventTarget.mousewheel(f.proxy(this._eventTarget_mousewheel,this));this._windowHandler=function(){b._resizeTimeout&&clearTimeout(b._resizeTimeout);b._resizeTimeout=setTimeout(function(){b._created&&b._$elem.geomap("resize",true)},500)};f(window).resize(this._windowHandler);this._$drawContainer.geographics({style:this._initOptions.drawStyle||{}});this._options.drawStyle=this._$drawContainer.geographics("option",
"style");this._$shapesContainer.geographics({style:this._initOptions.shapeStyle||{}});this._options.shapeStyle=this._$shapesContainer.geographics("option","style");if(this._initOptions){this._initOptions.tilingScheme&&this._setOption("tilingScheme",this._initOptions.tilingScheme,false);if(this._initOptions.services)this._options.services=f.merge([],this._initOptions.services);this._initOptions.bbox&&this._setOption("bbox",this._initOptions.bbox,false);this._initOptions.center&&this._setOption("center",
this._initOptions.center,false);this._initOptions.zoom!==q&&this._setZoom(this._initOptions.zoom,false,false)}f.template("geoMeasureLength"+this._widgetId,this._options.measureLabels.length);f.template("geoMeasureArea"+this._widgetId,this._options.measureLabels.area);this._$eventTarget.css("cursor",this._options.cursors[this._options.mode]);this._createServices();this._refresh();this._created=true}},_setOption:function(b,a,c){if(b!="pixelSize"){c=c===q||c;this._$elem.is(".geo-map")&&this._panFinalize();
switch(b){case "bbox":if(this._userGeodetic=f.geo.proj&&f.geo._isGeodetic(a))a=f.geo.proj.fromGeodetic(a);this._setBbox(a,false,c);a=this._getBbox();break;case "center":if(this._userGeodetic=f.geo.proj&&f.geo._isGeodetic(a))a=f.geo.proj.fromGeodetic(a);this._setCenterAndSize(a,this._pixelSize,false,c);break;case "measureLabels":a=f.extend(this._options.measureLabels,a);f.template("geoMeasureLength"+this._widgetId,a.length);f.template("geoMeasureArea"+this._widgetId,a.area);break;case "drawStyle":if(this._$drawContainer){this._$drawContainer.geographics("option",
"style",a);a=this._$drawContainer.geographics("option","style")}break;case "shapeStyle":if(this._$shapesContainer){this._$shapesContainer.geographics("option","style",a);a=this._$shapesContainer.geographics("option","style")}break;case "mode":this._resetDrawing();this._$eventTarget.css("cursor",this._options.cursors[a]);break;case "zoom":this._setZoom(a,false,c)}f.Widget.prototype._setOption.apply(this,arguments);switch(b){case "bbox":case "center":if(this._userGeodetic){this._options.bbox=f.geo.proj.toGeodetic(this._options.bbox);
this._options.center=f.geo.proj.toGeodetic(this._center)}break;case "tilingScheme":if(a!=null){this._pixelSizeMax=this._getPixelSize(0);this._centerMax=[a.origin[0]+this._pixelSizeMax*a.tileWidth/2,a.origin[1]+this._pixelSizeMax*a.tileHeight/2]}break;case "bboxMax":this._pixelSizeMax=this._getPixelSize(0);this._centerMax=f.geo.proj&&f.geo._isGeodetic(a)?f.geo.center(f.geo.proj.fromGeodetic(a)):f.geo.center(a);break;case "services":this._createServices();c&&this._refresh();break;case "shapeStyle":if(c){this._$shapesContainer.geographics("clear");
this._refreshShapes(this._$shapesContainer,this._graphicShapes,this._graphicShapes,this._graphicShapes)}}}},destroy:function(){if(this._$elem.is(".geo-service")){this._$shapesContainer.geographics("destroy");this._$shapesContainer=q}else{this._created=false;f(window).unbind("resize",this._windowHandler);for(var b=0;b<this._currentServices.length;b++){this._currentServices[b].serviceContainer.geomap("destroy");f.geo._serviceTypes[this._currentServices[b].type].destroy(this,this._$servicesContainer,
this._currentServices[b])}this._$shapesContainer.geographics("destroy");this._$shapesContainer=q;this._$drawContainer.geographics("destroy");this._$drawContainer=q;this._$existingChildren.detach();this._$elem.html("");this._$elem.append(this._$existingChildren);this._$elem.removeClass("geo-map")}f.Widget.prototype.destroy.apply(this,arguments)},toMap:function(b){b=this._toMap(b);return this._userGeodetic?f.geo.proj.toGeodetic(b):b},toPixel:function(b,a,c){return this._toPixel(f.geo.proj?f.geo.proj.fromGeodetic(b):
b,a,c)},opacity:function(b,a){if(this._$elem.is(".geo-service"))this._$elem.closest(".geo-map").geomap("opacity",b,this._$elem);else if(b>=0||b<=1)for(var c=0;c<this._currentServices.length;c++){var e=this._currentServices[c];if(!a||e.serviceContainer[0]==a[0]){e.style.opacity=b;f.geo._serviceTypes[e.type].opacity(this,e)}}},toggle:function(b,a){if(this._$elem.is(".geo-service"))this._$elem.closest(".geo-map").geomap("toggle",b,this._$elem);else for(var c=0;c<this._currentServices.length;c++){var e=
this._currentServices[c];if(!a||e.serviceContainer[0]==a[0]){if(b===q)b=e.style.visibility!=="visible";e.style.visibility=b?"visible":"hidden";e.serviceContainer.toggle(b);b&&f.geo._serviceTypes[e.type].refresh(this,e)}}},zoom:function(b){b!=null&&this._setZoom(this._options.zoom+b,false,true)},refresh:function(){this._refresh()},resize:function(b){var a=this._findMapSize(),c=a.width/2-this._contentBounds.width/2,e=a.height/2-this._contentBounds.height/2,d;this._contentBounds={x:parseInt(this._$elem.css("padding-left")),
y:parseInt(this._$elem.css("padding-top")),width:a.width,height:a.height};this._$resizeContainer.css({width:a.width,height:a.height});for(d=0;d<this._currentServices.length;d++)f.geo._serviceTypes[this._currentServices[d].type].resize(this,this._currentServices[d]);this._$elem.find(".geo-graphics").css({width:a.width,height:a.height}).geographics("resize");for(d=0;d<this._drawPixels.length;d++){this._drawPixels[d][0]+=c;this._drawPixels[d][1]+=e}this._setCenterAndSize(this._center,this._pixelSize,
b,true)},append:function(b){if(b&&f.isPlainObject(b)){var a,c,e,d,l,m;a=b.type=="FeatureCollection"?b.features:f.isArray(b)?b:[b];for(e=1;e<arguments.length;e++){c=arguments[e];if(typeof c==="object")d=c;else if(typeof c==="number"||typeof c==="string")l=c;else if(typeof c==="boolean")m=c}for(e=0;e<a.length;e++){if(a[e].type!="Point"){c=f.geo.bbox(a[e]);if(f.geo.proj&&f.geo._isGeodetic(c))c=f.geo.proj.fromGeodetic(c);f.data(a[e],"geoBbox",c)}this._graphicShapes.push({shape:a[e],style:d,label:l})}if(m===
q||m)this._refresh()}},empty:function(b){for(var a=0;a<this._graphicShapes.length;a++)f.removeData(this._graphicShapes[a].shape,"geoBbox");this._graphicShapes=[];if(b===q||b)this._refresh()},find:function(b,a){var c=f.isPlainObject(b);c&&this._map.toPixel(b.coordinates);for(var e=this._map._pixelSize*a,d=[],l,m,n,r=0;r<this._graphicShapes.length;r++){l=this._graphicShapes[r];if(c)if(l.shape.type=="Point")f.geo.distance(l.shape,b)<=e&&d.push(l.shape);else{m=f.data(l.shape,"geoBbox");m={type:"Polygon",
coordinates:[[[m[0],m[1]],[m[0],m[3]],[m[2],m[3]],[m[2],m[1]],[m[0],m[1]]]]};n={type:"Point",coordinates:f.geo.proj&&f.geo._isGeodetic(b.coordinates)?f.geo.proj.fromGeodetic(b.coordinates):b.coordinates};if(f.geo.distance(m,n,true)<=e){m=f.geo._flatten(l.shape);for(n=0;n<m.length;n++)if(f.geo.distance(m[n],b)<=e){d.push(l.shape);break}}}else d.push(l.shape)}this._$elem.is(".geo-map")&&this._$elem.find(".geo-service").each(function(){d=f.merge(d,f(this).geomap("find",b,a))});return d},remove:function(b,
a){for(var c=0;c<this._graphicShapes.length;c++)if(this._graphicShapes[c].shape==b){f.removeData(b,"geoBbox");var e=this._graphicShapes.slice(c+1);this._graphicShapes.length=c;this._graphicShapes.push.apply(this._graphicShapes,e);break}if(a===q||a)this._refresh()},_getBbox:function(b,a){b=b||this._center;a=a||this._pixelSize;var c=this._contentBounds.width/2*a,e=this._contentBounds.height/2*a;return[b[0]-c,b[1]-e,b[0]+c,b[1]+e]},_setBbox:function(b,a,c){var e=[b[0]+(b[2]-b[0])/2,b[1]+(b[3]-b[1])/
2];b=Math.max(f.geo.width(b,true)/this._contentBounds.width,f.geo.height(b,true)/this._contentBounds.height);if(this._options.tilingScheme)b=this._getPixelSize(this._getZoom(e,b));else if(this._getZoom(e,b)<0)b=this._pixelSizeMax;this._setCenterAndSize(e,b,a,c)},_getBboxMax:function(){var b=this._contentBounds.width/2*this._pixelSizeMax,a=this._contentBounds.height/2*this._pixelSizeMax;return[this._centerMax[0]-b,this._centerMax[1]-a,this._centerMax[0]+b,this._centerMax[1]+a]},_getCenter:function(){return this._center},
_getContentBounds:function(){return this._contentBounds},_getServicesContainer:function(){return this._$servicesContainer},_getZoom:function(b,a){b=b||this._center;a=a||this._pixelSize;var c=this._options.tilingScheme;if(c)if(c.pixelSizes!=null){for(var e=Math.floor(a*1E3),d=c.pixelSizes.length-1;d>=0;d--)if(Math.floor(c.pixelSizes[d]*1E3)>=e)return d;return 0}else return Math.max(Math.round(Math.log(c.basePixelSize/a)/Math.log(2)),0);else{e=this._contentBounds.width/this._contentBounds.height;c=
f.geo.reaspect(this._getBbox(b,a),e,true);e=f.geo.reaspect(this._getBboxMax(),e,true);return Math.max(Math.round(Math.log(f.geo.width(e,true)/f.geo.width(c,true))/Math.log(this._zoomFactor)),0)}},_setZoom:function(b,a,c){b=Math.max(b,0);this._setCenterAndSize(this._center,this._getPixelSize(b),a,c)},_createChildren:function(){this._$existingChildren=this._$elem.children();this._forcePosition(this._$existingChildren);this._$existingChildren.detach().css("-moz-user-select","none");var b="width:"+this._contentBounds.width+
"px; height:"+this._contentBounds.height+"px; margin:0; padding:0;";this._$elem.prepend('<div class="geo-event-target geo-content-frame" style="position:absolute; left:'+this._contentBounds.x+"px; top:"+this._contentBounds.y+"px;"+b+'overflow:hidden; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none;" unselectable="on"></div>');this._$eventTarget=this._$contentFrame=this._$elem.children(":first");this._$contentFrame.append('<div class="geo-services-container" style="position:absolute; left:0; top:0;'+
b+'"></div>');this._$servicesContainer=this._$contentFrame.children(":last");this._$contentFrame.append('<div class="geo-shapes-container" style="position:absolute; left:0; top:0;'+b+'"></div>');this._$shapesContainer=this._$contentFrame.children(":last");this._$contentFrame.append('<ul style="position: absolute; bottom: 8px; left: 8px; list-style-type: none; max-width: 50%; padding: 0; margin: 0;"></ul>');this._$attrList=this._$contentFrame.children(":last");this._$contentFrame.append('<div class="geo-draw-container" style="position:absolute; left:0; top:0;'+
b+'"></div>');this._$drawContainer=this._$contentFrame.children(":last");this._$contentFrame.append('<div class="geo-measure-container" style="position:absolute; left:0; top:0;'+b+'"><div class="geo-measure-label" style="position:absolute; left:0; top:0;; display: none;"></div></div>');this._$measureContainer=this._$contentFrame.children(":last");this._$measureLabel=this._$measureContainer.children();this._$panContainer=f([this._$shapesContainer[0],this._$drawContainer[0],this._$measureContainer[0]]);
this._$resizeContainer=f([this._$contentFrame[0],this._$servicesContainer[0],this._$eventTarget[0],this._$measureContainer[0]]);this._$contentFrame.append(this._$existingChildren);f("#geo-measure-style").length||f("head").prepend('<style type="text/css" id="geo-measure-style">.geo-measure-label { margin: 4px 0 0 6px; font-family: sans-serif;'+(h?"letter-spacing: 2px; color: #444; filter:progid:DXImageTransform.Microsoft.DropShadow(Color=white, OffX=1, OffY=2, Positive=true);":"color: #000; text-shadow: #fff 1px 2px; font-weight: bold;")+
" }</style>")},_createServices:function(){var b,a;for(a=0;a<this._currentServices.length;a++){this._currentServices[a].serviceContainer.geomap("destroy");f.geo._serviceTypes[this._currentServices[a].type].destroy(this,this._$servicesContainer,this._currentServices[a])}this._currentServices=[];this._$servicesContainer.html("");this._$attrList.html("");for(a=0;a<this._options.services.length;a++){b=this._currentServices[a]=f.extend({},this._options.services[a]);b.style=f.extend({visibility:"visible",
opacity:1},b.style);this._$servicesContainer.append("<div "+(b.id?' id="'+b.id+'"':"")+('class="geo-service '+(b["class"]?b["class"]:"")+'"')+' style="position:absolute; left:0; top:0; width:32px; height:32px; margin:0; padding:0; display:'+(b.style.visibility==="visible"?"block":"none")+';"></div>');serviceContainer=this._$servicesContainer.children(":last");this._currentServices[a].serviceContainer=serviceContainer;f.geo._serviceTypes[b.type].create(this,serviceContainer,b,a);serviceContainer.data("geoMap",
this).geomap();b.attr&&this._$attrList.append("<li>"+b.attr+"</li>")}this._$attrList.find("a").css({position:"relative",zIndex:100})},_refreshDrawing:function(){this._$drawContainer.geographics("clear");if(this._drawPixels.length>0){var b=this._options.mode,a=this._drawPixels,c=this._drawCoords,e,d;switch(b){case "measureLength":b="drawLineString";d={type:"LineString",coordinates:c};e=f.render({length:f.geo.length(d,true)},"geoMeasureLength"+this._widgetId);d=f.merge([],a[a.length-1]);break;case "measureArea":b=
"drawPolygon";d={type:"Polygon",coordinates:[f.merge([],c)]};d.coordinates[0].push(c[0]);e=f.render({area:f.geo.area(d,true)},"geoMeasureArea"+this._widgetId);d=f.merge([],a[a.length-1]);a=[a];break;case "drawPolygon":a=[a]}this._$drawContainer.geographics(b,a);if(e){this._$measureLabel.html(e);b=this._contentBounds.width-(this._$measureLabel.outerWidth(true)+d[0]);a=this._contentBounds.height-(this._$measureLabel.outerHeight(true)+d[1]);if(b<0)d[0]+=b;if(a<0)d[1]+=a;this._$measureLabel.css({left:d[0],
top:d[1]}).show()}}},_resetDrawing:function(){this._drawPixels=[];this._drawCoords=[];this._$drawContainer.geographics("clear");this._$measureLabel.hide()},_refreshShapes:function(b,a,c,e,d,l){var m,n,r,u,w,A,C,F=this._map._getBbox(d,l);for(m=0;m<a.length;m++){r=a[m].shape||a[m];r=r.geometry||r;n=f.data(r,"geoBbox");if(!(n&&f.geo._bboxDisjoint(F,n))){u=f.isArray(c)?c[m].style:c;w=f.isArray(e)?e[m].label:e;A=w!==q;C=q;switch(r.type){case "Point":C=this._map.toPixel(r.coordinates,d,l);this._$shapesContainer.geographics("drawPoint",
C,u);break;case "LineString":this._$shapesContainer.geographics("drawLineString",this._map.toPixel(r.coordinates,d,l),u);if(A)C=this._map.toPixel(f.geo.pointAlong(r,0.5).coordinates,d,l);break;case "Polygon":this._$shapesContainer.geographics("drawPolygon",this._map.toPixel(r.coordinates,d,l),u);if(A)C=this._map.toPixel(f.geo.centroid(r).coordinates,d,l);break;case "MultiPoint":for(n=0;n<r.coordinates.length;n++)this._$shapesContainer.geographics("drawPoint",this._map.toPixel(r.coordinates[n],d,l),
u);if(A)C=this._map.toPixel(f.geo.centroid(r).coordinates,d,l);break;case "MultiLineString":for(n=0;n<r.coordinates.length;n++)this._$shapesContainer.geographics("drawLineString",this._map.toPixel(r.coordinates[n],d,l),u);if(A)C=this._map.toPixel(f.geo.centroid(r).coordinates,d,l);break;case "MultiPolygon":for(n=0;n<r.coordinates.length;n++)this._$shapesContainer.geographics("drawPolygon",this._map.toPixel(r.coordinates[n],d,l),u);if(A)C=this._map.toPixel(f.geo.centroid(r).coordinates,d,l);break;
case "GeometryCollection":this._refreshShapes(b,r.geometries,u,w,d,l)}A&&C&&this._$shapesContainer.geographics("drawLabel",C,w)}}},_findMapSize:function(){for(var b={width:0,height:0},a=this._$elem;a.size()&&!(b.width>0&&b.height>0);){b={width:a.width(),height:a.height()};if(b.width<=0||b.height<=0)b={width:parseInt(a.css("width")),height:parseInt(a.css("height"))};a=a.parent()}return b},_forcePosition:function(b){var a=b.css("position");a!="relative"&&a!="absolute"&&a!="fixed"&&b.css("position",
"relative")},_getPixelSize:function(b){var a=this._options.tilingScheme;if(a!=null){if(b===0)return a.pixelSizes!=null?a.pixelSizes[0]:a.basePixelSize;b=Math.round(b);b=Math.max(b,0);b=Math.min(b,(a.pixelSizes!=null?a.pixelSizes.length:a.levels)-1);return a.pixelSizes!=null?a.pixelSizes[b]:a.basePixelSize/Math.pow(2,b)}else{b=f.geo.scaleBy(this._getBboxMax(),1/Math.pow(this._zoomFactor,b),true);return Math.max(f.geo.width(b,true)/this._contentBounds.width,f.geo.height(b,true)/this._contentBounds.height)}},
_getZoomCenterAndSize:function(b,a,c){a=Math.pow(c?this._fullZoomFactor:this._partialZoomFactor,-a);if(this._options.tilingScheme){a=this._getZoom(this._center,this._pixelSize*a);a=this._getPixelSize(a)}else{a=this._pixelSize*a;if(this._getZoom(this._center,a)<0)a=this._pixelSizeMax}c=a/this._pixelSize;b=this._toMap(b);c=[(this._center[0]-b[0])*c,(this._center[1]-b[1])*c];return{pixelSize:a,center:[b[0]+c[0],b[1]+c[1]]}},_mouseWheelFinish:function(){this._wheelTimeout=null;if(this._wheelLevel!=0){var b=
this._getZoomCenterAndSize(this._anchor,this._wheelLevel,this._options.tilingScheme!=null);this._setCenterAndSize(b.center,b.pixelSize,true,true);this._wheelLevel=0}else this._refresh()},_panEnd:function(){this._velocity=[this._velocity[0]>0?Math.floor(this._velocity[0]*this._friction[0]):Math.ceil(this._velocity[0]*this._friction[0]),this._velocity[1]>0?Math.floor(this._velocity[1]*this._friction[1]):Math.ceil(this._velocity[1]*this._friction[1])];if(Math.abs(this._velocity[0])<4&&Math.abs(this._velocity[1])<
4)this._panFinalize();else{this._current=[this._current[0]+this._velocity[0],this._current[1]+this._velocity[1]];this._panMove();setTimeout(f.proxy(this._panEnd,this),30)}},_panFinalize:function(){if(this._panning){this._velocity=[0,0];var b=-(this._current[0]-this._anchor[0])*this._pixelSize,a=(this._options.axisLayout==="image"?-1:1)*(this._current[1]-this._anchor[1])*this._pixelSize;this._$panContainer.css({left:0,top:0});this._$servicesContainer.find(".geo-shapes-container").css({left:0,top:0});
this._setCenterAndSize([this._center[0]+b,this._center[1]+a],this._pixelSize,true,true);this._$eventTarget.css("cursor",this._options.cursors[this._options.mode]);this._inOp=false;this._anchor=this._current;this._mouseDown=this._toolPan=this._panning=false}},_panMove:function(){if(this._options.pannable){var b=this._current[0]-this._lastDrag[0],a=this._current[1]-this._lastDrag[1],c=0,e,d;if(this._toolPan||b>3||b<-3||a>3||a<-3){if(!this._toolPan){this._toolPan=true;this._$eventTarget.css("cursor",
this._options.cursors.pan)}if(this._mouseDown)this._velocity=[b,a];if(b!=0||a!=0){this._panning=true;this._lastDrag=this._current;d={left:function(l,m){return parseInt(m)+b},top:function(l,m){return parseInt(m)+a}};for(c=0;c<this._currentServices.length;c++){e=this._currentServices[c];f.geo._serviceTypes[e.type].interactivePan(this,e,b,a);e.serviceContainer.find(".geo-shapes-container").css(d)}this._$panContainer.css(d)}}}},_refresh:function(){var b,a=0;if(this._$elem.is(".geo-map"))for(;a<this._currentServices.length;a++){b=
this._currentServices[a];if(!this._mouseDown&&f.geo._serviceTypes[b.type]!==null){f.geo._serviceTypes[b.type].refresh(this,b);b.serviceContainer.geomap("refresh")}}if(this._$shapesContainer){this._$shapesContainer.geographics("clear");this._graphicShapes.length>0&&this._refreshShapes(this._$shapesContainer,this._graphicShapes,this._graphicShapes,this._graphicShapes)}},_setCenterAndSize:function(b,a,c,e){if(!(!f.isArray(b)||b.length!=2||typeof b[0]!=="number"||typeof b[1]!=="number")){if(this._pixelSize!=
a){this._$elem.find(".geo-shapes-container").geographics("clear");for(var d=0;d<this._currentServices.length;d++){var l=this._currentServices[d];f.geo._serviceTypes[l.type].interactiveScale(this,l,b,a)}}this._center=f.merge([],b);this._options.pixelSize=this._pixelSize=a;if(this._userGeodetic){this._options.bbox=f.geo.proj.toGeodetic(this._getBbox());this._options.center=f.geo.proj.toGeodetic(this._center)}else{this._options.bbox=this._getBbox();this._options.center=f.merge([],b)}this._options.zoom=
this._getZoom();if(this._drawCoords.length>0)this._drawPixels=this._toPixel(this._drawCoords);c&&this._trigger("bboxchange",window.event,{bbox:f.merge([],this._options.bbox)});if(e){this._refresh();this._refreshDrawing()}}},_toMap:function(b,a,c){a=a||this._center;c=c||this._pixelSize;var e=f.isArray(b[0]),d=e&&f.isArray(b[0][0]),l=d&&f.isArray(b[0][0][0]),m=this._contentBounds.width,n=this._contentBounds.height,r=m/2*c;c=n/2*c;a=[a[0]-r,a[1]-c,a[0]+r,a[1]+c];m=f.geo.width(a,true)/m;n=f.geo.height(a,
true)/n;c=this._options.axisLayout==="image";var u=[],w,A,C;if(!l){if(!d){e||(b=[b]);b=[b]}b=[b]}for(w=0;w<b.length;w++){u[w]=[];for(A=0;A<b[w].length;A++){u[w][A]=[];for(C=0;C<b[w][A].length;C++){r=b[w][A][C][1]*n;u[w][A][C]=[a[0]+b[w][A][C][0]*m,c?a[1]+r:a[3]-r]}}}return l?u:d?u[0]:e?u[0][0]:u[0][0][0]},_toPixel:function(b,a,c){a=a||this._center;c=c||this._pixelSize;var e=f.isArray(b[0]),d=e&&f.isArray(b[0][0]),l=d&&f.isArray(b[0][0][0]),m=this._contentBounds.width,n=this._contentBounds.height,
r=m/2*c;c=n/2*c;a=[a[0]-r,a[1]-c,a[0]+r,a[1]+c];var u=f.geo.width(a,true);c=f.geo.height(a,true);r=this._options.axisLayout==="image";m=m/u;n=n/c;c=[];var w,A;if(!l){if(!d){e||(b=[b]);b=[b]}b=[b]}for(u=0;u<b.length;u++){c[u]=[];for(w=0;w<b[u].length;w++){c[u][w]=[];for(A=0;A<b[u][w].length;A++)c[u][w][A]=[Math.round((b[u][w][A][0]-a[0])*m),Math.round((r?b[u][w][A][1]-a[1]:a[3]-b[u][w][A][1])*n)]}}return l?c:d?c[0]:e?c[0][0]:c[0][0][0]},_zoomTo:function(b,a,c,e){a=a<0?0:a;a=this._getPixelSize(a);this._setCenterAndSize(b,
a,c,e)},_document_keydown:function(b){var a=this._drawCoords.length;if(a>0&&b.which==27)if(a<=2){this._resetDrawing();this._inOp=false}else{this._drawCoords[a-2]=f.merge([],this._drawCoords[a-1]);this._drawPixels[a-2]=f.merge([],this._drawPixels[a-1]);this._drawCoords.length--;this._drawPixels.length--;this._refreshDrawing()}},_eventTarget_dblclick_zoom:function(b){this._trigger("dblclick",b,{type:"Point",coordinates:this.toMap(this._current)});if(!b.isDefaultPrevented()){b=this._getZoomCenterAndSize(this._current,
1,true);this._setCenterAndSize(b.center,b.pixelSize,true,true)}},_eventTarget_dblclick:function(b){if(this._options.mode!=="static"){this._panFinalize();if(this._drawTimeout){window.clearTimeout(this._drawTimeout);this._drawTimeout=null}f(b.currentTarget).offset();switch(this._options.mode){case "drawLineString":case "measureLength":if(this._drawCoords.length>1&&!(this._drawCoords[0][0]==this._drawCoords[1][0]&&this._drawCoords[0][1]==this._drawCoords[1][1])){this._drawCoords.length--;this._trigger("shape",
b,{type:"LineString",coordinates:this._userGeodetic?f.geo.proj.toGeodetic(this._drawCoords):this._drawCoords})}else this._eventTarget_dblclick_zoom(b);this._resetDrawing();break;case "drawPolygon":case "measureArea":if(this._drawCoords.length>1&&!(this._drawCoords[0][0]==this._drawCoords[1][0]&&this._drawCoords[0][1]==this._drawCoords[1][1])){var a=this._drawCoords.length-1;if(a>2){this._drawCoords[a]=f.merge([],this._drawCoords[0]);this._trigger("shape",b,{type:"Polygon",coordinates:[this._userGeodetic?
f.geo.proj.toGeodetic(this._drawCoords):this._drawCoords]})}}else this._eventTarget_dblclick_zoom(b);this._resetDrawing();break;default:this._eventTarget_dblclick_zoom(b)}this._inOp=false}},_eventTarget_touchstart:function(b){if(this._options.mode!=="static")if(!(!this._supportTouch&&b.which!=1)){this._panFinalize();this._mouseWheelFinish();var a=f(b.currentTarget).offset(),c=b.originalEvent.changedTouches;if(this._supportTouch){this._multiTouchAnchor=f.merge([],c);if(this._isMultiTouch=this._multiTouchAnchor.length>
1){this._multiTouchCurrentBbox=[c[0].pageX-a.left,c[0].pageY-a.top,c[1].pageX-a.left,c[1].pageY-a.top];this._multiTouchAnchorBbox=f.merge([],this._multiTouchCurrentBbox);this._current=f.geo.center(this._multiTouchCurrentBbox,true)}else{this._multiTouchCurrentBbox=[c[0].pageX-a.left,c[0].pageY-a.top,NaN,NaN];this._current=[c[0].pageX-a.left,c[0].pageY-a.top]}}else this._current=[b.pageX-a.left,b.pageY-a.top];if(this._softDblClick){a=f.now();if(a-this._downDate<750){if(this._isTap){c=this._current[0]-
this._anchor[0];var e=this._current[1]-this._anchor[1];if(Math.sqrt(c*c+e*e)>8)this._isTap=false;else this._current=f.merge([],this._anchor)}this._isDbltap=this._isDbltap?false:this._isTap}else this._isDbltap=false;this._isTap=true;this._downDate=a}this._mouseDown=true;this._anchor=f.merge([],this._current);if(!this._inOp&&b.shiftKey){this._shiftZoom=true;this._$eventTarget.css("cursor",this._options.cursors.zoom)}else if(!this._isMultiTouch&&this._options.pannable){this._inOp=true;switch(this._options.mode){case "zoom":break;
default:this._lastDrag=this._current;b.currentTarget.setCapture&&b.currentTarget.setCapture()}}b.preventDefault();return false}},_dragTarget_touchmove:function(b){if(this._options.mode!=="static"){var a=this._$eventTarget.offset(),c=this._drawCoords.length,e=b.originalEvent.changedTouches,d;d=0;if(this._supportTouch){if(!this._isMultiTouch&&e[0].identifier!==this._multiTouchAnchor[0].identifier){this._mouseDown=false;this._dragTarget_touchstop(b);this._isMultiTouch=true;this._multiTouchAnchor.push(e[0]);
this._multiTouchCurrentBbox=[this._multiTouchCurrentBbox[0],this._multiTouchCurrentBbox[1],this._multiTouchAnchor[1].pageX-a.left,this._multiTouchAnchor[1].pageY-a.top];this._multiTouchAnchorBbox=f.merge([],this._multiTouchCurrentBbox);this._mouseDown=true;this._anchor=this._current=f.geo.center(this._multiTouchCurrentBbox,true);return false}if(this._isMultiTouch){for(;d<e.length;d++)if(e[d].identifier===this._multiTouchAnchor[0].identifier){this._multiTouchCurrentBbox[0]=e[d].pageX-a.left;this._multiTouchCurrentBbox[1]=
e[d].pageY-a.top}else if(e[d].identifier===this._multiTouchAnchor[1].identifier){this._multiTouchCurrentBbox[2]=e[d].pageX-a.left;this._multiTouchCurrentBbox[3]=e[d].pageY-a.top}f.geo.center(this._multiTouchCurrentBbox,true);d=this._multiTouchCurrentBbox[2]-this._multiTouchCurrentBbox[0];a=this._multiTouchAnchorBbox[2]-this._multiTouchAnchorBbox[0];this._wheelLevel=Math.abs(Math.floor((1-d/a)*10));if(Math.abs(d)<Math.abs(a))this._wheelLevel=-this._wheelLevel;e=this._getZoomCenterAndSize(this._anchor,
this._wheelLevel,false);this._$elem.find(".geo-shapes-container").geographics("clear");for(d=0;d<this._currentServices.length;d++){a=this._currentServices[d];f.geo._serviceTypes[a.type].interactiveScale(this,a,e.center,e.pixelSize)}this._graphicShapes.length>0&&this._graphicShapes.length<256&&this._refreshShapes(this._$shapesContainer,this._graphicShapes,this._graphicShapes,this._graphicShapes,e.center,e.pixelSize);if(this._drawCoords.length>0){this._drawPixels=this._toPixel(this._drawCoords,e.center,
e.pixelSize);this._refreshDrawing()}d=f.geo.center(this._multiTouchCurrentBbox,true)}else d=[b.originalEvent.changedTouches[0].pageX-a.left,b.originalEvent.changedTouches[0].pageY-a.top]}else d=[b.pageX-a.left,b.pageY-a.top];if(d[0]===this._lastMove[0]&&d[1]===this._lastMove[1])if(this._inOp){b.preventDefault();return false}if(h==7)this._isDbltap=this._isTap=false;if(this._mouseDown){this._current=d;this._moveDate=f.now()}if(this._isMultiTouch){b.preventDefault();return this._isDbltap=this._isTap=
false}switch(this._shiftZoom?"zoom":this._options.mode){case "zoom":if(this._mouseDown){this._$drawContainer.geographics("clear");this._$drawContainer.geographics("drawBbox",[this._anchor[0],this._anchor[1],d[0],d[1]])}else this._trigger("move",b,{type:"Point",coordinates:this.toMap(d)});break;case "drawLineString":case "drawPolygon":case "measureLength":case "measureArea":if(this._mouseDown||this._toolPan)this._panMove();else{if(c>0){this._drawCoords[c-1]=this._toMap(d);this._drawPixels[c-1]=d;this._refreshDrawing()}this._trigger("move",
b,{type:"Point",coordinates:this.toMap(d)})}break;default:this._mouseDown||this._toolPan?this._panMove():this._trigger("move",b,{type:"Point",coordinates:this.toMap(d)})}this._lastMove=d;if(this._inOp){b.preventDefault();return false}}},_dragTarget_touchstop:function(b){if(this._options.mode!=="static"){!this._mouseDown&&h==7&&this._eventTarget_touchstart(b);var a=this._mouseDown,c=this._toolPan,e=this._$eventTarget.offset(),d=this._shiftZoom?"zoom":this._options.mode,l,m;l=this._supportTouch?[b.originalEvent.changedTouches[0].pageX-
e.left,b.originalEvent.changedTouches[0].pageY-e.top]:[b.pageX-e.left,b.pageY-e.top];if(this._softDblClick)if(this._isTap){e=l[0]-this._anchor[0];m=l[1]-this._anchor[1];if(Math.sqrt(e*e+m*m)<=8)l=f.merge([],this._anchor)}e=l[0]-this._anchor[0];m=l[1]-this._anchor[1];this._$eventTarget.css("cursor",this._options.cursors[this._options.mode]);this._shiftZoom=this._mouseDown=this._toolPan=false;if(this._isMultiTouch){b.preventDefault();this._isMultiTouch=false;a=this._getZoomCenterAndSize(this._anchor,
this._wheelLevel,false);this._setCenterAndSize(a.center,a.pixelSize,true,true);this._wheelLevel=0;return false}document.releaseCapture&&document.releaseCapture();if(a){a=f.now();this._current=l;switch(d){case "zoom":if(e!=0||m!=0){c=this._pixelSize*6;d=this._toMap([[Math.min(this._anchor[0],l[0]),Math.max(this._anchor[1],l[1])],[Math.max(this._anchor[0],l[0]),Math.min(this._anchor[1],l[1])]]);d=[d[0][0],d[0][1],d[1][0],d[1][1]];if(d[2]-d[0]<c&&d[3]-d[1]<c)d=f.geo.scaleBy(this._getBbox(f.geo.center(d,
true)),0.5,true);this._setBbox(d,true,true)}this._resetDrawing();break;case "drawPoint":if(this._drawTimeout){window.clearTimeout(this._drawTimeout);this._drawTimeout=null}if(c)this._panFinalize();else if(a-this._clickDate>100){var n=this;this._drawTimeout=setTimeout(function(){if(n._drawTimeout){n._trigger("shape",b,{type:"Point",coordinates:n.toMap(l)});n._inOp=false;n._drawTimeout=null}},250)}break;case "drawLineString":case "drawPolygon":case "measureLength":case "measureArea":if(c)this._panFinalize();
else{c=this._drawCoords.length==0?0:this._drawCoords.length-1;this._drawCoords[c]=this._toMap(l);this._drawPixels[c]=l;if(c<2||!(this._drawCoords[c][0]==this._drawCoords[c-1][0]&&this._drawCoords[c][1]==this._drawCoords[c-1][1])){this._drawCoords[c+1]=this._toMap(l);this._drawPixels[c+1]=l}this._refreshDrawing()}break;default:if(c)this._panEnd();else if(a-this._clickDate>100){this._trigger("click",b,{type:"Point",coordinates:this.toMap(l)});this._inOp=false}}this._clickDate=a;if(this._softDblClick&&
this._isDbltap){this._isDbltap=this._isTap=false;this._$eventTarget.trigger("dblclick",b)}}if(this._inOp){b.preventDefault();return false}}},_eventTarget_mousewheel:function(b,a){if(!(this._options.mode==="static"||this._options.scroll==="off")){b.preventDefault();this._panFinalize();if(this._mouseDown)return false;if(a!=0){if(this._wheelTimeout){window.clearTimeout(this._wheelTimeout);this._wheelTimeout=null}else{var c=f(b.currentTarget).offset();this._anchor=[b.pageX-c.left,b.pageY-c.top]}this._wheelLevel+=
a;c=this._getZoomCenterAndSize(this._anchor,this._wheelLevel,this._options.tilingScheme!=null);var e,d=0;for(this._$elem.find(".geo-shapes-container").geographics("clear");d<this._currentServices.length;d++){e=this._currentServices[d];f.geo._serviceTypes[e.type].interactiveScale(this,e,c.center,c.pixelSize)}this._graphicShapes.length>0&&this._graphicShapes.length<256&&this._refreshShapes(this._$shapesContainer,this._graphicShapes,this._graphicShapes,this._graphicShapes,c.center,c.pixelSize);if(this._drawCoords.length>
0){this._drawPixels=this._toPixel(this._drawCoords,c.center,c.pixelSize);this._refreshDrawing()}var l=this;this._wheelTimeout=window.setTimeout(function(){l._mouseWheelFinish()},1E3)}return false}}})})(jQuery);
(function(f,q){f.geo._serviceTypes.tiled=function(){return{create:function(t,h,b){t=f.data(b,"geoServiceState");if(!t){t={loadCount:0,reloadTiles:false};h.append('<div data-geo-service="tiled" style="position:absolute; left:0; top:0; width:8px; height:8px; margin:0; padding:0;"></div>');t.serviceContainer=h.children(":last");f.data(b,"geoServiceState",t)}return t.serviceContainer},destroy:function(t,h,b){f.data(b,"geoServiceState").serviceContainer.remove();f.removeData(b,"geoServiceState")},interactivePan:function(t,
h,b,a){var c=f.data(h,"geoServiceState");if(c){this._cancelUnloaded(t,h);c.serviceContainer.children().css("-moz-transition","").css({webkitTransition:"",transition:"",left:function(R,U){return parseInt(U)+b},top:function(R,U){return parseInt(U)+a}});if(h&&h.style.visibility==="visible"){var e=t._pixelSize,d=this,l=c.serviceContainer,m=l.children("[data-pixelSize='"+e+"']"),n=t._getContentBounds(),r=t.options.axisLayout==="image",u=r?+1:-1,w=t.options.tilingScheme,A=w.tileWidth,C=w.tileHeight,F=n.width/
2*e,y=n.height/2*e,K=m.position(),E=m.data("scaleOrigin").split(",");n=parseInt(E[0])-K.left;K=parseInt(E[1])-K.top;var J=t._getCenter();E=[J[0]+n*e,J[1]+u*K*e];var P=Math.floor((E[0]-F-w.origin[0])/(e*A));n=Math.max(Math.floor((r?E[1]-y-w.origin[1]:w.origin[1]-(E[1]+y))/(e*C)),0);K=Math.ceil((E[0]+F-w.origin[0])/(e*A));E=Math.ceil((r?E[1]+y-w.origin[1]:w.origin[1]-(E[1]-y))/(e*C));var I=t._getBboxMax(),D=t._getPixelSize(0),H=D/e,M=Math.floor((I[0]-w.origin[0])/(D*A))*H;I=Math.floor((w.origin[1]+
u*I[3])/(D*C))*H;D=w.origin[1]+u*I*C*e;F=Math.round((w.origin[0]+M*A*e-(J[0]-F))/e);r=Math.round((r?D-(J[1]-y):J[1]+y-D)/e);var z=h.style.opacity;for(y=P;y<K;y++)for(J=n;J<E;J++){P=""+y+","+J;var L=m.children("[data-tile='"+P+"']").removeAttr("data-dirty");if(L.size()===0){D=[w.origin[0]+y*A*e,w.origin[1]+u*J*C*e];H=[w.origin[0]+((y+1)*A-1)*e,w.origin[1]+u*((J+1)*C-1)*e];H=[D[0],D[1],H[0],H[1]];D=h.hasOwnProperty("src")?"src":"getUrl";H={bbox:H,width:A,height:C,zoom:t._getZoom(),tile:{row:J,column:y},
index:Math.abs(J+y)};if(f.isFunction(h[D]))D=h[D](H);else{f.template("geoSrc",h[D]);D=f.render(H,"geoSrc")}c.loadCount++;if(c.reloadTiles&&L.size()>0)L.attr("src",D);else{H="<img style='position:absolute; left:"+((y-M)*100+(F-F%A)/A*100)+"%; top:"+((J-I)*100+(r-r%C)/C*100)+"%; ";if(f("body")[0].filters===q)H+="width: 100%; height: 100%;";H+="margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;' unselectable='on' data-tile='"+
P+"' />";m.append(H);L=m.children(":last")}typeof D==="string"?d._loadImage(L,D,e,c,l,z):D.done(function(R){d._loadImage(L,R,e,c,l,z)}).fail(function(){L.remove();c.loadCount--})}}}}},interactiveScale:function(t,h,b,a){var c=f.data(h,"geoServiceState");if(c&&h&&h.style.visibility==="visible"){this._cancelUnloaded(t,h);h=t.options.tilingScheme;var e=h.tileWidth,d=h.tileHeight;c.serviceContainer.children().each(function(){var l=f(this),m=l.attr("data-pixelSize")/a;m=Math.round(m*1E3)/1E3;var n=l.data("scaleOrigin").split(",");
n=t._toMap([n[0],n[1]]);n=t._toPixel(n,b,a);l.css("-moz-transition","").css({webkitTransition:"",transition:"",left:Math.round(n[0])+"px",top:Math.round(n[1])+"px",width:e*m,height:d*m});f("body")[0].filters!==q&&l.children().each(function(){f(this).css("filter","progid:DXImageTransform.Microsoft.Matrix(FilterType=bilinear,M11="+m+",M22="+m+",sizingmethod='auto expand')")})})}},refresh:function(t,h){var b=f.data(h,"geoServiceState");this._cancelUnloaded(t,h);if(b&&h&&h.style.visibility==="visible"&&
!b.serviceContainer.is(":hidden")){var a=t._getBbox(),c=t._pixelSize,e=this,d=b.serviceContainer;t._getContentBounds();var l=t.options.axisLayout==="image",m=l?+1:-1,n=t.options.tilingScheme,r=n.tileWidth,u=n.tileHeight,w=Math.floor((a[0]-n.origin[0])/(c*r)),A=Math.max(Math.floor((l?a[1]-n.origin[1]:n.origin[1]-a[3])/(c*u)),0),C=Math.ceil((a[2]-n.origin[0])/(c*r)),F=Math.ceil((l?a[3]-n.origin[1]:n.origin[1]-a[1])/(c*u)),y=t._getBboxMax(),K=t._getPixelSize(0),E=K/c,J=Math.floor((y[0]-n.origin[0])/
(K*r))*E,P=Math.floor((n.origin[1]+m*y[3])/(K*u))*E;y=n.origin[1]+m*P*u*c;var I=Math.round((n.origin[0]+J*r*c-a[0])/c),D=Math.round((l?y-a[1]:a[3]-y)/c);a=d.children().show();l=a.filter("[data-pixelSize='"+c+"']").appendTo(d);var H=h.style.opacity;b.reloadTiles&&a.find("img").attr("data-dirty","true");if(l.size()){l.css({left:I%r+"px",top:D%u+"px"}).data("scaleOrigin",I%r+","+D%u);l.children().each(function(){var L=f(this),R=L.attr("data-tile").split(",");L.css({left:Math.round((parseInt(R[0])-J)*
100+(I-I%r)/r*100)+"%",top:Math.round((parseInt(R[1])-P)*100+(D-D%u)/u*100)+"%"});H<1&&L.fadeTo(0,H)})}else{d.append("<div style='position:absolute; left:"+I%r+"px; top:"+D%u+"px; width:"+r+"px; height:"+u+"px; margin:0; padding:0;' data-pixelSize='"+c+"'></div>");l=d.children(":last").data("scaleOrigin",I%r+","+D%u)}for(w=w;w<C;w++)for(y=A;y<F;y++){K=""+w+","+y;var M=l.children("[data-tile='"+K+"']").removeAttr("data-dirty");if(M.size()===0||b.reloadTiles){E=[n.origin[0]+w*r*c,n.origin[1]+m*y*u*
c];var z=[n.origin[0]+((w+1)*r-1)*c,n.origin[1]+m*((y+1)*u-1)*c];z=[E[0],E[1],z[0],z[1]];E=h.hasOwnProperty("src")?"src":"getUrl";z={bbox:z,width:r,height:u,zoom:t._getZoom(),tile:{row:y,column:w},index:Math.abs(y+w)};if(f.isFunction(h[E]))E=h[E](z);else{f.template("geoSrc",h[E]);E=f.render(z,"geoSrc")}b.loadCount++;if(b.reloadTiles&&M.size()>0)M.attr("src",E);else{z="<img style='position:absolute; left:"+((w-J)*100+(I-I%r)/r*100)+"%; top:"+((y-P)*100+(D-D%u)/u*100)+"%; ";if(f("body")[0].filters===
q)z+="width: 100%; height: 100%;";z+="margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;' unselectable='on' data-tile='"+K+"' />";l.append(z);M=l.children(":last")}typeof E==="string"?e._loadImage(M,E,c,b,d,H):E.done(function(L){e._loadImage(M,L,c,b,d,H)}).fail(function(){M.remove();b.loadCount--})}}a.find("[data-dirty]").remove();b.reloadTiles=false}},resize:function(){},opacity:function(t,h){f.data(h,"geoServiceState").serviceContainer.find("img").stop(true).fadeTo("fast",
h.style.opacity)},toggle:function(t,h){f.data(h,"geoServiceState").serviceContainer.css("display",h.style.visibility==="visible"?"block":"none")},_cancelUnloaded:function(t,h){var b=f.data(h,"geoServiceState");if(b&&b.loadCount>0)for(b.serviceContainer.find("img:hidden").remove();b.loadCount>0;)b.loadCount--},_loadImage:function(t,h,b,a,c,e){t.load(function(d){e<1?f(d.target).fadeTo(0,e):f(d.target).show();a.loadCount--;if(a.loadCount<=0){c.children(":not([data-pixelSize='"+b+"'])").remove();a.loadCount=
0}}).error(function(d){f(d.target).remove();a.loadCount--;if(a.loadCount<=0){c.children(":not([data-pixelSize='"+b+"'])").remove();a.loadCount=0}}).attr("src",h)}}}()})(jQuery);
(function(f){f.geo._serviceTypes.shingled=function(){return{create:function(q,t,h){q=f.data(h,"geoServiceState");if(!q){q={loadCount:0};t.append('<div data-geo-service="shingled" style="position:absolute; left:0; top:0; width:16px; height:16px; margin:0; padding:0;"></div>');q.serviceContainer=t.children(":last");f.data(h,"geoServiceState",q)}return q.serviceContainer},destroy:function(q,t,h){f.data(h,"geoServiceState").serviceContainer.remove();f.removeData(h,"geoServiceState")},interactivePan:function(q,
t,h,b){var a=f.data(t,"geoServiceState");if(a){this._cancelUnloaded(q,t);t=a.serviceContainer;q=q._pixelSize;a=t.children("[data-pixelSize='"+q+"']");var c=a.children("div");if(!c.length){a.children("img").wrap('<div style="position:absolute; left:0; top:0; width:100%; height:100%;"></div>');c=a.children("div")}c.css({left:function(e,d){return parseInt(d)+h},top:function(e,d){return parseInt(d)+b}});t.children(":not([data-pixelSize='"+q+"'])").remove()}},interactiveScale:function(q,t,h,b){var a=f.data(t,
"geoServiceState");if(a){this._cancelUnloaded(q,t);t=a.serviceContainer;q=q._getContentBounds();var c=q.width,e=q.height,d=c/2,l=e/2;t.children().each(function(){var m=f(this),n=m.attr("data-pixelSize"),r=n/b;m.css({width:c*r,height:e*r}).children("img").each(function(){var u=f(this),w=u.data("center");u.css({left:(Math.round((w[0]-h[0])/n)-d)*r+"px",top:(Math.round((h[1]-w[1])/n)-l)*r+"px"})})})}},refresh:function(q,t){var h=f.data(t,"geoServiceState");this._cancelUnloaded(q,t);if(h&&t&&t.style.visibility===
"visible"&&!h.serviceContainer.is(":hidden")){var b=q._getBbox(),a=q._pixelSize,c=this,e=h.serviceContainer,d=q._getContentBounds(),l=d.width,m=d.height,n=l/2,r=m/2;d=e.children('[data-pixelSize="'+a+'"]');var u=t.style.opacity,w;if(!d.size()){e.append('<div style="position:absolute; left:'+n+"px; top:"+r+"px; width:"+l+"px; height:"+m+'px; margin:0; padding:0;" data-pixelSize="'+a+'"></div>');d=e.children(":last")}d.children("img").each(function(){var C=f(this),F=C.data("center"),y=q._getCenter();
C.css({left:Math.round((F[0]-y[0])/a)-n+"px",top:Math.round((y[1]-F[1])/a)-r+"px"})});u<1&&e.find("img").attr("data-keepAlive","0");var A=t.hasOwnProperty("src")?"src":"getUrl";b={bbox:b,width:l,height:m,zoom:q._getZoom(),tile:null,index:0};if(f.isFunction(t[A]))b=t[A](b);else{f.template("geoSrc",t[A]);b=f.render(b,"geoSrc")}h.loadCount++;d.append('<img style="position:absolute; left:-'+n+"px; top:-"+r+'px; width:100%; height:100%; margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;" unselectable="on" />');
w=d.children(":last").data("center",q._getCenter());typeof b==="string"?c._loadImage(w,b,a,h,e,u):b.done(function(C){c._loadImage(w,C,a,h,e,u)}).fail(function(){w.remove();h.loadCount--})}},resize:function(q,t){var h=f.data(t,"geoServiceState");if(h&&t&&t.style.visibility==="visible"){this._cancelUnloaded(q,t);var b=h.serviceContainer,a=q._getContentBounds();h=a.width/2;a=a.height/2;b=b.children();b.attr("data-pixelSize","0");b.css({left:h+"px",top:a+"px"})}},opacity:function(q,t){f.data(t,"geoServiceState").serviceContainer.find("img").stop(true).fadeTo("fast",
t.style.opacity)},toggle:function(q,t){f.data(t,"geoServiceState").serviceContainer.css("display",t.style.visibility==="visible"?"block":"none")},_cancelUnloaded:function(q,t){var h=f.data(t,"geoServiceState");if(h&&h.loadCount>0)for(h.serviceContainer.find("img:hidden").remove();h.loadCount>0;)h.loadCount--},_loadImage:function(q,t,h,b,a,c){q.load(function(e){c<1?f(e.target).fadeTo(0,c):f(e.target).show();b.loadCount--;if(b.loadCount<=0){a.children(':not([data-pixelSize="'+h+'"])').remove();e=a.find('[data-pixelSize="'+
h+'"]>div');if(e.size()>0){var d=e.position();e.children("img").each(function(){var l=f(this),m=d.left+parseInt(l.css("left")),n=d.top+parseInt(l.css("top"));l.css({left:m+"px",top:n+"px"})}).unwrap();e.remove()}b.loadCount=0}}).error(function(e){f(e.target).remove();b.loadCount--;if(b.loadCount<=0){a.children(":not([data-pixelSize='"+h+"'])").remove();b.loadCount=0}}).attr("src",t)}}}()})(jQuery);
/*! Copyright (c) 2011 Brandon Aaron (http://brandonaaron.net)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
 * Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
 * Thanks to: Seamus Leahy for adding deltaX and deltaY
 *
 * Version: 3.0.6
 * 
 * Requires: 1.2.2+
 */
(function(a){function d(b){var c=b||window.event,d=[].slice.call(arguments,1),e=0,f=!0,g=0,h=0;return b=a.event.fix(c),b.type="mousewheel",c.wheelDelta&&(e=c.wheelDelta/120),c.detail&&(e=-c.detail/3),h=e,c.axis!==undefined&&c.axis===c.HORIZONTAL_AXIS&&(h=0,g=-1*e),c.wheelDeltaY!==undefined&&(h=c.wheelDeltaY/120),c.wheelDeltaX!==undefined&&(g=-1*c.wheelDeltaX/120),d.unshift(b,e,g,h),(a.event.dispatch||a.event.handle).apply(this,d)}var b=["DOMMouseScroll","mousewheel"];if(a.event.fixHooks)for(var c=b.length;c;)a.event.fixHooks[b[--c]]=a.event.mouseHooks;a.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=b.length;a;)this.addEventListener(b[--a],d,!1);else this.onmousewheel=d},teardown:function(){if(this.removeEventListener)for(var a=b.length;a;)this.removeEventListener(b[--a],d,!1);else this.onmousewheel=null}},a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})})(jQuery)