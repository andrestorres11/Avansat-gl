<?php/********************************************SCRIPT: EXPORTA CONSULTA A EXCEL/********************************************/class Exportar{  //Metodos  function __construct($qu,$bd)  {    define(db_host, "localhost");    define(db_user, "lromero");    define(db_pass, "leonardo");    define(db_link, mysql_connect(db_host,db_user,db_pass));    define(db_name, "$bd");    mysql_select_db(db_name);    /********************************************/    //se esta enviando el caracter \    //procedimeinto para eliminarlo    $qu = explode("\\",$qu);    for($i=0;$i<sizeof($qu);$i++)      $query .= $qu[$i];    $export = mysql_query($query);    $count = mysql_num_fields($export);    /********************************************/    for ($i = 0; $i < $count; $i++)    {             $header .= mysql_field_name($export, $i)."\t";    }//fin for    /********************************************/    while($row = mysql_fetch_row($export))    {            $line = '';            foreach($row as $value)      {                     if ((!isset($value)) OR ($value == "")) {                           $value = "\t";                  }//fin if      else      {                           $value = str_replace('"', '""', $value);                           $value = '"' . $value . '"' . "\t";                  }//fin else                  $line .= $value;            }//fin foreach          $data .= trim($line)."\n";    }//fin while    $data = str_replace("\r", "", $data);    /********************************************/    if ($data == "")    {            $data = "\n(0) Records Found!\n";    }//fin if    /********************************************/    header('Content-Type: application/octetstream');    header('Expires: 0');    header('Content-Disposition: attachment; filename="exportar.xls"');    header('Cache-Control: must-revalidate, post-check=0, pre-check=0');    header('Pragma: public');    print "$header\n$data";  }//fin function}//fin class  $exportar = new Exportar($_REQUEST[query],$_REQUEST[based]);?>